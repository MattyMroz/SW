#include"stm32l4xx_hal.h"#ifdefHAL_RCC_MODULE_ENABLED#definePLLSAI1_TIMEOUT_VALUE2U#definePLLSAI2_TIMEOUT_VALUE2U#definePLL_TIMEOUT_VALUE2U#defineDIVIDER_P_UPDATE0U#defineDIVIDER_Q_UPDATE1U#defineDIVIDER_R_UPDATE2U#define__LSCO_CLK_ENABLE()__HAL_RCC_GPIOA_CLK_ENABLE()#defineLSCO_GPIO_PORTGPIOA#defineLSCO_PINGPIO_PIN_2#ifdefined(RCC_PLLSAI1_SUPPORT)staticHAL_StatusTypeDefRCCEx_PLLSAI1_Config(RCC_PLLSAI1InitTypeDef*PllSai1,uint32_tDivider);#endif#ifdefined(RCC_PLLSAI2_SUPPORT)staticHAL_StatusTypeDefRCCEx_PLLSAI2_Config(RCC_PLLSAI2InitTypeDef*PllSai2,uint32_tDivider);#endif#ifdefined(SAI1)staticuint32_tRCCEx_GetSAIxPeriphCLKFreq(uint32_tPeriphClk,uint32_tInputFrequency);#endifHAL_StatusTypeDefHAL_RCCEx_PeriphCLKConfig(RCC_PeriphCLKInitTypeDef*PeriphClkInit){uint32_ttmpregister,tickstart;HAL_StatusTypeDefret=HAL_OK;HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_RCC_PERIPHCLOCK(PeriphClkInit->PeriphClockSelection));#ifdefined(SAI1)if((((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_SAI1)==RCC_PERIPHCLK_SAI1)){assert_param(IS_RCC_SAI1CLK(PeriphClkInit->Sai1ClockSelection));switch(PeriphClkInit->Sai1ClockSelection){caseRCC_SAI1CLKSOURCE_PLL:#ifdefined(RCC_PLLSAI2_SUPPORT)__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_SAI3CLK);#else__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_SAI2CLK);#endifbreak;caseRCC_SAI1CLKSOURCE_PLLSAI1:ret=RCCEx_PLLSAI1_Config(&(PeriphClkInit->PLLSAI1),DIVIDER_P_UPDATE);break;#ifdefined(RCC_PLLSAI2_SUPPORT)caseRCC_SAI1CLKSOURCE_PLLSAI2:ret=RCCEx_PLLSAI2_Config(&(PeriphClkInit->PLLSAI2),DIVIDER_P_UPDATE);break;#endifcaseRCC_SAI1CLKSOURCE_PIN:#ifdefined(STM32L4P5xx)||defined(STM32L4Q5xx)||defined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)caseRCC_SAI1CLKSOURCE_HSI:#endifbreak;default:ret=HAL_ERROR;break;}if(ret==HAL_OK){__HAL_RCC_SAI1_CONFIG(PeriphClkInit->Sai1ClockSelection);}else{status=ret;}}#endif#ifdefined(SAI2)if((((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_SAI2)==RCC_PERIPHCLK_SAI2)){assert_param(IS_RCC_SAI2CLK(PeriphClkInit->Sai2ClockSelection));switch(PeriphClkInit->Sai2ClockSelection){caseRCC_SAI2CLKSOURCE_PLL:__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_SAI3CLK);break;caseRCC_SAI2CLKSOURCE_PLLSAI1:ret=RCCEx_PLLSAI1_Config(&(PeriphClkInit->PLLSAI1),DIVIDER_P_UPDATE);break;caseRCC_SAI2CLKSOURCE_PLLSAI2:ret=RCCEx_PLLSAI2_Config(&(PeriphClkInit->PLLSAI2),DIVIDER_P_UPDATE);break;caseRCC_SAI2CLKSOURCE_PIN:#ifdefined(STM32L4P5xx)||defined(STM32L4Q5xx)||defined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)caseRCC_SAI2CLKSOURCE_HSI:#endifbreak;default:ret=HAL_ERROR;break;}if(ret==HAL_OK){__HAL_RCC_SAI2_CONFIG(PeriphClkInit->Sai2ClockSelection);}else{status=ret;}}#endifif((PeriphClkInit->PeriphClockSelection&RCC_PERIPHCLK_RTC)==RCC_PERIPHCLK_RTC){FlagStatuspwrclkchanged=RESET;assert_param(IS_RCC_RTCCLKSOURCE(PeriphClkInit->RTCClockSelection));if(__HAL_RCC_PWR_IS_CLK_DISABLED()!=0U){__HAL_RCC_PWR_CLK_ENABLE();pwrclkchanged=SET;}SET_BIT(PWR->CR1,PWR_CR1_DBP);tickstart=HAL_GetTick();while(READ_BIT(PWR->CR1,PWR_CR1_DBP)==0U){if((HAL_GetTick()-tickstart)>RCC_DBP_TIMEOUT_VALUE){ret=HAL_TIMEOUT;break;}}if(ret==HAL_OK){tmpregister=READ_BIT(RCC->BDCR,RCC_BDCR_RTCSEL);if((tmpregister!=RCC_RTCCLKSOURCE_NONE)&&(tmpregister!=PeriphClkInit->RTCClockSelection)){tmpregister=READ_BIT(RCC->BDCR,~(RCC_BDCR_RTCSEL));__HAL_RCC_BACKUPRESET_FORCE();__HAL_RCC_BACKUPRESET_RELEASE();RCC->BDCR=tmpregister;}if(HAL_IS_BIT_SET(tmpregister,RCC_BDCR_LSEON)){tickstart=HAL_GetTick();while(READ_BIT(RCC->BDCR,RCC_BDCR_LSERDY)==0U){if((HAL_GetTick()-tickstart)>RCC_LSE_TIMEOUT_VALUE){ret=HAL_TIMEOUT;break;}}}if(ret==HAL_OK){__HAL_RCC_RTC_CONFIG(PeriphClkInit->RTCClockSelection);}else{status=ret;}}else{status=ret;}if(pwrclkchanged==SET){__HAL_RCC_PWR_CLK_DISABLE();}}if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_USART1)==RCC_PERIPHCLK_USART1){assert_param(IS_RCC_USART1CLKSOURCE(PeriphClkInit->Usart1ClockSelection));__HAL_RCC_USART1_CONFIG(PeriphClkInit->Usart1ClockSelection);}if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_USART2)==RCC_PERIPHCLK_USART2){assert_param(IS_RCC_USART2CLKSOURCE(PeriphClkInit->Usart2ClockSelection));__HAL_RCC_USART2_CONFIG(PeriphClkInit->Usart2ClockSelection);}#ifdefined(USART3)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_USART3)==RCC_PERIPHCLK_USART3){assert_param(IS_RCC_USART3CLKSOURCE(PeriphClkInit->Usart3ClockSelection));__HAL_RCC_USART3_CONFIG(PeriphClkInit->Usart3ClockSelection);}#endif#ifdefined(UART4)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_UART4)==RCC_PERIPHCLK_UART4){assert_param(IS_RCC_UART4CLKSOURCE(PeriphClkInit->Uart4ClockSelection));__HAL_RCC_UART4_CONFIG(PeriphClkInit->Uart4ClockSelection);}#endif#ifdefined(UART5)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_UART5)==RCC_PERIPHCLK_UART5){assert_param(IS_RCC_UART5CLKSOURCE(PeriphClkInit->Uart5ClockSelection));__HAL_RCC_UART5_CONFIG(PeriphClkInit->Uart5ClockSelection);}#endifif(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_LPUART1)==RCC_PERIPHCLK_LPUART1){assert_param(IS_RCC_LPUART1CLKSOURCE(PeriphClkInit->Lpuart1ClockSelection));__HAL_RCC_LPUART1_CONFIG(PeriphClkInit->Lpuart1ClockSelection);}if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_LPTIM1)==(RCC_PERIPHCLK_LPTIM1)){assert_param(IS_RCC_LPTIM1CLK(PeriphClkInit->Lptim1ClockSelection));__HAL_RCC_LPTIM1_CONFIG(PeriphClkInit->Lptim1ClockSelection);}if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_LPTIM2)==(RCC_PERIPHCLK_LPTIM2)){assert_param(IS_RCC_LPTIM2CLK(PeriphClkInit->Lptim2ClockSelection));__HAL_RCC_LPTIM2_CONFIG(PeriphClkInit->Lptim2ClockSelection);}if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_I2C1)==RCC_PERIPHCLK_I2C1){assert_param(IS_RCC_I2C1CLKSOURCE(PeriphClkInit->I2c1ClockSelection));__HAL_RCC_I2C1_CONFIG(PeriphClkInit->I2c1ClockSelection);}#ifdefined(I2C2)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_I2C2)==RCC_PERIPHCLK_I2C2){assert_param(IS_RCC_I2C2CLKSOURCE(PeriphClkInit->I2c2ClockSelection));__HAL_RCC_I2C2_CONFIG(PeriphClkInit->I2c2ClockSelection);}#endifif(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_I2C3)==RCC_PERIPHCLK_I2C3){assert_param(IS_RCC_I2C3CLKSOURCE(PeriphClkInit->I2c3ClockSelection));__HAL_RCC_I2C3_CONFIG(PeriphClkInit->I2c3ClockSelection);}#ifdefined(I2C4)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_I2C4)==RCC_PERIPHCLK_I2C4){assert_param(IS_RCC_I2C4CLKSOURCE(PeriphClkInit->I2c4ClockSelection));__HAL_RCC_I2C4_CONFIG(PeriphClkInit->I2c4ClockSelection);}#endif#ifdefined(USB_OTG_FS)||defined(USB)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_USB)==(RCC_PERIPHCLK_USB)){assert_param(IS_RCC_USBCLKSOURCE(PeriphClkInit->UsbClockSelection));__HAL_RCC_USB_CONFIG(PeriphClkInit->UsbClockSelection);if(PeriphClkInit->UsbClockSelection==RCC_USBCLKSOURCE_PLL){__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_48M1CLK);}else{#ifdefined(RCC_PLLSAI1_SUPPORT)if(PeriphClkInit->UsbClockSelection==RCC_USBCLKSOURCE_PLLSAI1){ret=RCCEx_PLLSAI1_Config(&(PeriphClkInit->PLLSAI1),DIVIDER_Q_UPDATE);if(ret!=HAL_OK){status=ret;}}#endif}}#endif#ifdefined(SDMMC1)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_SDMMC1)==(RCC_PERIPHCLK_SDMMC1)){assert_param(IS_RCC_SDMMC1CLKSOURCE(PeriphClkInit->Sdmmc1ClockSelection));__HAL_RCC_SDMMC1_CONFIG(PeriphClkInit->Sdmmc1ClockSelection);if(PeriphClkInit->Sdmmc1ClockSelection==RCC_SDMMC1CLKSOURCE_PLL){__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_48M1CLK);}#ifdefined(RCC_CCIPR2_SDMMCSEL)elseif(PeriphClkInit->Sdmmc1ClockSelection==RCC_SDMMC1CLKSOURCE_PLLP){__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_SAI3CLK);}#endifelseif(PeriphClkInit->Sdmmc1ClockSelection==RCC_SDMMC1CLKSOURCE_PLLSAI1){ret=RCCEx_PLLSAI1_Config(&(PeriphClkInit->PLLSAI1),DIVIDER_Q_UPDATE);if(ret!=HAL_OK){status=ret;}}else{}}#endifif(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_RNG)==(RCC_PERIPHCLK_RNG)){assert_param(IS_RCC_RNGCLKSOURCE(PeriphClkInit->RngClockSelection));__HAL_RCC_RNG_CONFIG(PeriphClkInit->RngClockSelection);if(PeriphClkInit->RngClockSelection==RCC_RNGCLKSOURCE_PLL){__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_48M1CLK);}#ifdefined(RCC_PLLSAI1_SUPPORT)elseif(PeriphClkInit->RngClockSelection==RCC_RNGCLKSOURCE_PLLSAI1){ret=RCCEx_PLLSAI1_Config(&(PeriphClkInit->PLLSAI1),DIVIDER_Q_UPDATE);if(ret!=HAL_OK){status=ret;}}#endifelse{}}#if!defined(STM32L412xx)&&!defined(STM32L422xx)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_ADC)==RCC_PERIPHCLK_ADC){assert_param(IS_RCC_ADCCLKSOURCE(PeriphClkInit->AdcClockSelection));__HAL_RCC_ADC_CONFIG(PeriphClkInit->AdcClockSelection);#ifdefined(RCC_PLLSAI1_SUPPORT)if(PeriphClkInit->AdcClockSelection==RCC_ADCCLKSOURCE_PLLSAI1){ret=RCCEx_PLLSAI1_Config(&(PeriphClkInit->PLLSAI1),DIVIDER_R_UPDATE);if(ret!=HAL_OK){status=ret;}}#endif#ifdefined(STM32L471xx)||defined(STM32L475xx)||defined(STM32L476xx)||defined(STM32L485xx)||defined(STM32L486xx)||defined(STM32L496xx)||defined(STM32L4A6xx)elseif(PeriphClkInit->AdcClockSelection==RCC_ADCCLKSOURCE_PLLSAI2){ret=RCCEx_PLLSAI2_Config(&(PeriphClkInit->PLLSAI2),DIVIDER_R_UPDATE);if(ret!=HAL_OK){status=ret;}}else{}#endif}#endif#ifdefined(SWPMI1)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_SWPMI1)==RCC_PERIPHCLK_SWPMI1){assert_param(IS_RCC_SWPMI1CLKSOURCE(PeriphClkInit->Swpmi1ClockSelection));__HAL_RCC_SWPMI1_CONFIG(PeriphClkInit->Swpmi1ClockSelection);}#endif#ifdefined(DFSDM1_Filter0)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_DFSDM1)==RCC_PERIPHCLK_DFSDM1){assert_param(IS_RCC_DFSDM1CLKSOURCE(PeriphClkInit->Dfsdm1ClockSelection));__HAL_RCC_DFSDM1_CONFIG(PeriphClkInit->Dfsdm1ClockSelection);}#ifdefined(STM32L4P5xx)||defined(STM32L4Q5xx)||defined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_DFSDM1AUDIO)==RCC_PERIPHCLK_DFSDM1AUDIO){assert_param(IS_RCC_DFSDM1AUDIOCLKSOURCE(PeriphClkInit->Dfsdm1AudioClockSelection));__HAL_RCC_DFSDM1AUDIO_CONFIG(PeriphClkInit->Dfsdm1AudioClockSelection);}#endif#endif#ifdefined(LTDC)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_LTDC)==RCC_PERIPHCLK_LTDC){assert_param(IS_RCC_LTDCCLKSOURCE(PeriphClkInit->LtdcClockSelection));__HAL_RCC_PLLSAI2_DISABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI2RDY)!=0U){if((HAL_GetTick()-tickstart)>PLLSAI2_TIMEOUT_VALUE){ret=HAL_TIMEOUT;break;}}if(ret==HAL_OK){__HAL_RCC_LTDC_CONFIG(PeriphClkInit->LtdcClockSelection);ret=RCCEx_PLLSAI2_Config(&(PeriphClkInit->PLLSAI2),DIVIDER_R_UPDATE);}if(ret!=HAL_OK){status=ret;}}#endif#ifdefined(DSI)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_DSI)==RCC_PERIPHCLK_DSI){assert_param(IS_RCC_DSICLKSOURCE(PeriphClkInit->DsiClockSelection));__HAL_RCC_DSI_CONFIG(PeriphClkInit->DsiClockSelection);if(PeriphClkInit->DsiClockSelection==RCC_DSICLKSOURCE_PLLSAI2){ret=RCCEx_PLLSAI2_Config(&(PeriphClkInit->PLLSAI2),DIVIDER_Q_UPDATE);if(ret!=HAL_OK){status=ret;}}}#endif#ifdefined(OCTOSPI1)||defined(OCTOSPI2)if(((PeriphClkInit->PeriphClockSelection)&RCC_PERIPHCLK_OSPI)==RCC_PERIPHCLK_OSPI){assert_param(IS_RCC_OSPICLKSOURCE(PeriphClkInit->OspiClockSelection));__HAL_RCC_OSPI_CONFIG(PeriphClkInit->OspiClockSelection);if(PeriphClkInit->OspiClockSelection==RCC_OSPICLKSOURCE_PLL){__HAL_RCC_PLLCLKOUT_ENABLE(RCC_PLL_48M1CLK);}}#endifreturnstatus;}voidHAL_RCCEx_GetPeriphCLKConfig(RCC_PeriphCLKInitTypeDef*PeriphClkInit){#ifdefined(STM32L412xx)||defined(STM32L422xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_RNG|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L431xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_SWPMI1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L432xx)||defined(STM32L442xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C3|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_SWPMI1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L433xx)||defined(STM32L443xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_SWPMI1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L451xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|RCC_PERIPHCLK_I2C4|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L452xx)||defined(STM32L462xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|RCC_PERIPHCLK_I2C4|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L471xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|RCC_PERIPHCLK_UART5|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_SAI2|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_SWPMI1|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L475xx)||defined(STM32L476xx)||defined(STM32L485xx)||defined(STM32L486xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|RCC_PERIPHCLK_UART5|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_SAI2|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_SWPMI1|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L496xx)||defined(STM32L4A6xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|RCC_PERIPHCLK_UART5|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|RCC_PERIPHCLK_I2C4|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_SAI2|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_SWPMI1|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_RTC;#elifdefined(STM32L4R5xx)||defined(STM32L4S5xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|RCC_PERIPHCLK_UART5|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|RCC_PERIPHCLK_I2C4|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_SAI2|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_DFSDM1AUDIO|RCC_PERIPHCLK_RTC|RCC_PERIPHCLK_OSPI;#elifdefined(STM32L4R7xx)||defined(STM32L4S7xx)||defined(STM32L4Q5xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|RCC_PERIPHCLK_UART5|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|RCC_PERIPHCLK_I2C4|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_SAI2|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_DFSDM1AUDIO|RCC_PERIPHCLK_RTC|RCC_PERIPHCLK_OSPI|RCC_PERIPHCLK_LTDC;#elifdefined(STM32L4R9xx)||defined(STM32L4S9xx)PeriphClkInit->PeriphClockSelection=RCC_PERIPHCLK_USART1|RCC_PERIPHCLK_USART2|RCC_PERIPHCLK_USART3|RCC_PERIPHCLK_UART4|RCC_PERIPHCLK_UART5|\RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1|RCC_PERIPHCLK_I2C2|RCC_PERIPHCLK_I2C3|RCC_PERIPHCLK_I2C4|\RCC_PERIPHCLK_LPTIM1|RCC_PERIPHCLK_LPTIM2|RCC_PERIPHCLK_SAI1|RCC_PERIPHCLK_SAI2|RCC_PERIPHCLK_USB|\RCC_PERIPHCLK_SDMMC1|RCC_PERIPHCLK_RNG|RCC_PERIPHCLK_ADC|RCC_PERIPHCLK_DFSDM1|\RCC_PERIPHCLK_DFSDM1AUDIO|RCC_PERIPHCLK_RTC|RCC_PERIPHCLK_OSPI|RCC_PERIPHCLK_LTDC|RCC_PERIPHCLK_DSI;#endif#ifdefined(RCC_PLLSAI1_SUPPORT)PeriphClkInit->PLLSAI1.PLLSAI1Source=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC)>>RCC_PLLCFGR_PLLSRC_Pos;#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)PeriphClkInit->PLLSAI1.PLLSAI1M=(READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1M)>>RCC_PLLSAI1CFGR_PLLSAI1M_Pos)+1U;#elsePeriphClkInit->PLLSAI1.PLLSAI1M=(READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U;#endifPeriphClkInit->PLLSAI1.PLLSAI1N=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N)>>RCC_PLLSAI1CFGR_PLLSAI1N_Pos;PeriphClkInit->PLLSAI1.PLLSAI1P=((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1P)>>RCC_PLLSAI1CFGR_PLLSAI1P_Pos)<<4U)+7U;PeriphClkInit->PLLSAI1.PLLSAI1Q=((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1Q)>>RCC_PLLSAI1CFGR_PLLSAI1Q_Pos)+1U)*2U;PeriphClkInit->PLLSAI1.PLLSAI1R=((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1R)>>RCC_PLLSAI1CFGR_PLLSAI1R_Pos)+1U)*2U;#endif#ifdefined(RCC_PLLSAI2_SUPPORT)PeriphClkInit->PLLSAI2.PLLSAI2Source=PeriphClkInit->PLLSAI1.PLLSAI1Source;#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)PeriphClkInit->PLLSAI2.PLLSAI2M=(READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2M)>>RCC_PLLSAI2CFGR_PLLSAI2M_Pos)+1U;#elsePeriphClkInit->PLLSAI2.PLLSAI2M=PeriphClkInit->PLLSAI1.PLLSAI1M;#endifPeriphClkInit->PLLSAI2.PLLSAI2N=READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N)>>RCC_PLLSAI2CFGR_PLLSAI2N_Pos;PeriphClkInit->PLLSAI2.PLLSAI2P=((READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2P)>>RCC_PLLSAI2CFGR_PLLSAI2P_Pos)<<4U)+7U;#ifdefined(RCC_PLLSAI2Q_DIV_SUPPORT)PeriphClkInit->PLLSAI2.PLLSAI2Q=((READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2Q)>>RCC_PLLSAI2CFGR_PLLSAI2Q_Pos)+1U)*2U;#endifPeriphClkInit->PLLSAI2.PLLSAI2R=((READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2R)>>RCC_PLLSAI2CFGR_PLLSAI2R_Pos)+1U)*2U;#endifPeriphClkInit->Usart1ClockSelection=__HAL_RCC_GET_USART1_SOURCE();PeriphClkInit->Usart2ClockSelection=__HAL_RCC_GET_USART2_SOURCE();#ifdefined(USART3)PeriphClkInit->Usart3ClockSelection=__HAL_RCC_GET_USART3_SOURCE();#endif#ifdefined(UART4)PeriphClkInit->Uart4ClockSelection=__HAL_RCC_GET_UART4_SOURCE();#endif#ifdefined(UART5)PeriphClkInit->Uart5ClockSelection=__HAL_RCC_GET_UART5_SOURCE();#endifPeriphClkInit->Lpuart1ClockSelection=__HAL_RCC_GET_LPUART1_SOURCE();PeriphClkInit->I2c1ClockSelection=__HAL_RCC_GET_I2C1_SOURCE();#ifdefined(I2C2)PeriphClkInit->I2c2ClockSelection=__HAL_RCC_GET_I2C2_SOURCE();#endifPeriphClkInit->I2c3ClockSelection=__HAL_RCC_GET_I2C3_SOURCE();#ifdefined(I2C4)PeriphClkInit->I2c4ClockSelection=__HAL_RCC_GET_I2C4_SOURCE();#endifPeriphClkInit->Lptim1ClockSelection=__HAL_RCC_GET_LPTIM1_SOURCE();PeriphClkInit->Lptim2ClockSelection=__HAL_RCC_GET_LPTIM2_SOURCE();#ifdefined(SAI1)PeriphClkInit->Sai1ClockSelection=__HAL_RCC_GET_SAI1_SOURCE();#endif#ifdefined(SAI2)PeriphClkInit->Sai2ClockSelection=__HAL_RCC_GET_SAI2_SOURCE();#endifPeriphClkInit->RTCClockSelection=__HAL_RCC_GET_RTC_SOURCE();#ifdefined(USB_OTG_FS)||defined(USB)PeriphClkInit->UsbClockSelection=__HAL_RCC_GET_USB_SOURCE();#endif#ifdefined(SDMMC1)PeriphClkInit->Sdmmc1ClockSelection=__HAL_RCC_GET_SDMMC1_SOURCE();#endifPeriphClkInit->RngClockSelection=__HAL_RCC_GET_RNG_SOURCE();#if!defined(STM32L412xx)&&!defined(STM32L422xx)PeriphClkInit->AdcClockSelection=__HAL_RCC_GET_ADC_SOURCE();#endif#ifdefined(SWPMI1)PeriphClkInit->Swpmi1ClockSelection=__HAL_RCC_GET_SWPMI1_SOURCE();#endif#ifdefined(DFSDM1_Filter0)PeriphClkInit->Dfsdm1ClockSelection=__HAL_RCC_GET_DFSDM1_SOURCE();#ifdefined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)PeriphClkInit->Dfsdm1AudioClockSelection=__HAL_RCC_GET_DFSDM1AUDIO_SOURCE();#endif#endif#ifdefined(LTDC)PeriphClkInit->LtdcClockSelection=__HAL_RCC_GET_LTDC_SOURCE();#endif#ifdefined(DSI)PeriphClkInit->DsiClockSelection=__HAL_RCC_GET_DSI_SOURCE();#endif#ifdefined(OCTOSPI1)||defined(OCTOSPI2)PeriphClkInit->OspiClockSelection=__HAL_RCC_GET_OSPI_SOURCE();#endif}uint32_tHAL_RCCEx_GetPeriphCLKFreq(uint32_tPeriphClk){uint32_tfrequency=0U;uint32_tsrcclk,pll_oscsource,pllvco,plln;#ifdefined(SDMMC1)&&defined(RCC_CCIPR2_SDMMCSEL)uint32_tpllp;#endifassert_param(IS_RCC_PERIPHCLOCK(PeriphClk));if(PeriphClk==RCC_PERIPHCLK_RTC){srcclk=__HAL_RCC_GET_RTC_SOURCE();switch(srcclk){caseRCC_RTCCLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;caseRCC_RTCCLKSOURCE_LSI:if(HAL_IS_BIT_SET(RCC->CSR,RCC_CSR_LSIRDY)){#ifdefined(RCC_CSR_LSIPREDIV)if(HAL_IS_BIT_SET(RCC->CSR,RCC_CSR_LSIPREDIV)){frequency=LSI_VALUE/128U;}else#endif{frequency=LSI_VALUE;}}break;caseRCC_RTCCLKSOURCE_HSE_DIV32:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSERDY)){frequency=HSE_VALUE/32U;}break;default:break;}}else{pll_oscsource=__HAL_RCC_GET_PLL_OSCSOURCE();switch(pll_oscsource){caseRCC_PLLSOURCE_MSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_MSIRDY)){pllvco=MSIRangeTable[(__HAL_RCC_GET_MSI_RANGE()>>4U)];}else{pllvco=0U;}break;caseRCC_PLLSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){pllvco=HSI_VALUE;}else{pllvco=0U;}break;caseRCC_PLLSOURCE_HSE:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSERDY)){pllvco=HSE_VALUE;}else{pllvco=0U;}break;default:pllvco=0U;break;}switch(PeriphClk){#ifdefined(SAI1)caseRCC_PERIPHCLK_SAI1:frequency=RCCEx_GetSAIxPeriphCLKFreq(RCC_PERIPHCLK_SAI1,pllvco);break;#endif#ifdefined(SAI2)caseRCC_PERIPHCLK_SAI2:frequency=RCCEx_GetSAIxPeriphCLKFreq(RCC_PERIPHCLK_SAI2,pllvco);break;#endif#ifdefined(USB_OTG_FS)||defined(USB)caseRCC_PERIPHCLK_USB:#endifcaseRCC_PERIPHCLK_RNG:#ifdefined(SDMMC1)&&!defined(RCC_CCIPR2_SDMMCSEL)caseRCC_PERIPHCLK_SDMMC1:#endif{srcclk=READ_BIT(RCC->CCIPR,RCC_CCIPR_CLK48SEL);switch(srcclk){caseRCC_CCIPR_CLK48SEL:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_MSIRDY)){frequency=MSIRangeTable[(__HAL_RCC_GET_MSI_RANGE()>>4U)];}break;caseRCC_CCIPR_CLK48SEL_1:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLRDY)){if(HAL_IS_BIT_SET(RCC->PLLCFGR,RCC_PLLCFGR_PLLQEN)){plln=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLN)>>RCC_PLLCFGR_PLLN_Pos;pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));frequency=(pllvco/(((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLQ)>>RCC_PLLCFGR_PLLQ_Pos)+1U)<<1U));}}break;#ifdefined(RCC_PLLSAI1_SUPPORT)caseRCC_CCIPR_CLK48SEL_0:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLSAI1RDY)){if(HAL_IS_BIT_SET(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1QEN)){plln=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N)>>RCC_PLLSAI1CFGR_PLLSAI1N_Pos;#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1M)>>RCC_PLLSAI1CFGR_PLLSAI1M_Pos)+1U));#elsepllvco=((pllvco*plln)/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));#endiffrequency=(pllvco/(((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1Q)>>RCC_PLLSAI1CFGR_PLLSAI1Q_Pos)+1U)<<1U));}}break;#endif#ifdefined(RCC_HSI48_SUPPORT)case0U:if(HAL_IS_BIT_SET(RCC->CRRCR,RCC_CRRCR_HSI48RDY)){frequency=HSI48_VALUE;}break;#endifdefault:break;}break;}#ifdefined(SDMMC1)&&defined(RCC_CCIPR2_SDMMCSEL)caseRCC_PERIPHCLK_SDMMC1:if(HAL_IS_BIT_SET(RCC->CCIPR2,RCC_CCIPR2_SDMMCSEL)){if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLRDY)){if(HAL_IS_BIT_SET(RCC->PLLCFGR,RCC_PLLCFGR_PLLPEN)){plln=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLN)>>RCC_PLLCFGR_PLLN_Pos;pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));pllp=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLPDIV)>>RCC_PLLCFGR_PLLPDIV_Pos;if(pllp==0U){if(READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLP)!=0U){pllp=17U;}else{pllp=7U;}}frequency=(pllvco/pllp);}}}else{srcclk=READ_BIT(RCC->CCIPR,RCC_CCIPR_CLK48SEL);switch(srcclk){caseRCC_CCIPR_CLK48SEL:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_MSIRDY)){frequency=MSIRangeTable[(__HAL_RCC_GET_MSI_RANGE()>>4U)];}break;caseRCC_CCIPR_CLK48SEL_1:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLRDY)){if(HAL_IS_BIT_SET(RCC->PLLCFGR,RCC_PLLCFGR_PLLQEN)){plln=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLN)>>RCC_PLLCFGR_PLLN_Pos;pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));frequency=(pllvco/(((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLQ)>>RCC_PLLCFGR_PLLQ_Pos)+1U)<<1U));}}break;caseRCC_CCIPR_CLK48SEL_0:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLSAI1RDY)){if(HAL_IS_BIT_SET(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1QEN)){plln=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N)>>RCC_PLLSAI1CFGR_PLLSAI1N_Pos;pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1M)>>RCC_PLLSAI1CFGR_PLLSAI1M_Pos)+1U));frequency=(pllvco/(((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1Q)>>RCC_PLLSAI1CFGR_PLLSAI1Q_Pos)+1U)<<1U));}}break;case0U:if(HAL_IS_BIT_SET(RCC->CRRCR,RCC_CRRCR_HSI48RDY)){frequency=HSI48_VALUE;}break;default:break;}}break;#endifcaseRCC_PERIPHCLK_USART1:{srcclk=__HAL_RCC_GET_USART1_SOURCE();switch(srcclk){caseRCC_USART1CLKSOURCE_PCLK2:frequency=HAL_RCC_GetPCLK2Freq();break;caseRCC_USART1CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_USART1CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_USART1CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}caseRCC_PERIPHCLK_USART2:{srcclk=__HAL_RCC_GET_USART2_SOURCE();switch(srcclk){caseRCC_USART2CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_USART2CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_USART2CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_USART2CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}#ifdefined(USART3)caseRCC_PERIPHCLK_USART3:{srcclk=__HAL_RCC_GET_USART3_SOURCE();switch(srcclk){caseRCC_USART3CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_USART3CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_USART3CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_USART3CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}#endif#ifdefined(UART4)caseRCC_PERIPHCLK_UART4:{srcclk=__HAL_RCC_GET_UART4_SOURCE();switch(srcclk){caseRCC_UART4CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_UART4CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_UART4CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_UART4CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}#endif#ifdefined(UART5)caseRCC_PERIPHCLK_UART5:{srcclk=__HAL_RCC_GET_UART5_SOURCE();switch(srcclk){caseRCC_UART5CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_UART5CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_UART5CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_UART5CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}#endifcaseRCC_PERIPHCLK_LPUART1:{srcclk=__HAL_RCC_GET_LPUART1_SOURCE();switch(srcclk){caseRCC_LPUART1CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_LPUART1CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_LPUART1CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_LPUART1CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}caseRCC_PERIPHCLK_ADC:{srcclk=__HAL_RCC_GET_ADC_SOURCE();switch(srcclk){caseRCC_ADCCLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;#ifdefined(RCC_PLLSAI1_SUPPORT)caseRCC_ADCCLKSOURCE_PLLSAI1:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLSAI1RDY)&&(__HAL_RCC_GET_PLLSAI1CLKOUT_CONFIG(RCC_PLLSAI1_ADC1CLK)!=0U)){plln=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N)>>RCC_PLLSAI1CFGR_PLLSAI1N_Pos;#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1M)>>RCC_PLLSAI1CFGR_PLLSAI1M_Pos)+1U));#elsepllvco=((pllvco*plln)/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));#endiffrequency=(pllvco/(((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1R)>>RCC_PLLSAI1CFGR_PLLSAI1R_Pos)+1U)<<1U));}break;#endif#ifdefined(STM32L471xx)||defined(STM32L475xx)||defined(STM32L476xx)||defined(STM32L485xx)||defined(STM32L486xx)||defined(STM32L496xx)||defined(STM32L4A6xx)caseRCC_ADCCLKSOURCE_PLLSAI2:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLSAI2RDY)&&(__HAL_RCC_GET_PLLSAI2CLKOUT_CONFIG(RCC_PLLSAI2_ADC2CLK)!=0U)){plln=READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N)>>RCC_PLLSAI2CFGR_PLLSAI2N_Pos;#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2M)>>RCC_PLLSAI2CFGR_PLLSAI2M_Pos)+1U));#elsepllvco=((pllvco*plln)/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));#endiffrequency=(pllvco/(((READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2R)>>RCC_PLLSAI2CFGR_PLLSAI2R_Pos)+1U)<<1U));}break;#endifdefault:break;}break;}#ifdefined(DFSDM1_Filter0)caseRCC_PERIPHCLK_DFSDM1:{srcclk=__HAL_RCC_GET_DFSDM1_SOURCE();if(srcclk==RCC_DFSDM1CLKSOURCE_PCLK2){frequency=HAL_RCC_GetPCLK2Freq();}else{frequency=HAL_RCC_GetSysClockFreq();}break;}#ifdefined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)caseRCC_PERIPHCLK_DFSDM1AUDIO:{srcclk=__HAL_RCC_GET_DFSDM1AUDIO_SOURCE();switch(srcclk){caseRCC_DFSDM1AUDIOCLKSOURCE_SAI1:frequency=RCCEx_GetSAIxPeriphCLKFreq(RCC_PERIPHCLK_SAI1,pllvco);break;caseRCC_DFSDM1AUDIOCLKSOURCE_MSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_MSIRDY)){frequency=MSIRangeTable[(__HAL_RCC_GET_MSI_RANGE()>>4U)];}break;caseRCC_DFSDM1AUDIOCLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;default:break;}break;}#endif#endifcaseRCC_PERIPHCLK_I2C1:{srcclk=__HAL_RCC_GET_I2C1_SOURCE();switch(srcclk){caseRCC_I2C1CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_I2C1CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_I2C1CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;default:break;}break;}#ifdefined(I2C2)caseRCC_PERIPHCLK_I2C2:{srcclk=__HAL_RCC_GET_I2C2_SOURCE();switch(srcclk){caseRCC_I2C2CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_I2C2CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_I2C2CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;default:break;}break;}#endifcaseRCC_PERIPHCLK_I2C3:{srcclk=__HAL_RCC_GET_I2C3_SOURCE();switch(srcclk){caseRCC_I2C3CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_I2C3CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_I2C3CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;default:break;}break;}#ifdefined(I2C4)caseRCC_PERIPHCLK_I2C4:{srcclk=__HAL_RCC_GET_I2C4_SOURCE();switch(srcclk){caseRCC_I2C4CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_I2C4CLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_I2C4CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;default:break;}break;}#endifcaseRCC_PERIPHCLK_LPTIM1:{srcclk=__HAL_RCC_GET_LPTIM1_SOURCE();switch(srcclk){caseRCC_LPTIM1CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_LPTIM1CLKSOURCE_LSI:if(HAL_IS_BIT_SET(RCC->CSR,RCC_CSR_LSIRDY)){#ifdefined(RCC_CSR_LSIPREDIV)if(HAL_IS_BIT_SET(RCC->CSR,RCC_CSR_LSIPREDIV)){frequency=LSI_VALUE/128U;}else#endif{frequency=LSI_VALUE;}}break;caseRCC_LPTIM1CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_LPTIM1CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}caseRCC_PERIPHCLK_LPTIM2:{srcclk=__HAL_RCC_GET_LPTIM2_SOURCE();switch(srcclk){caseRCC_LPTIM2CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_LPTIM2CLKSOURCE_LSI:if(HAL_IS_BIT_SET(RCC->CSR,RCC_CSR_LSIRDY)){#ifdefined(RCC_CSR_LSIPREDIV)if(HAL_IS_BIT_SET(RCC->CSR,RCC_CSR_LSIPREDIV)){frequency=LSI_VALUE/128U;}else#endif{frequency=LSI_VALUE;}}break;caseRCC_LPTIM2CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;caseRCC_LPTIM2CLKSOURCE_LSE:if(HAL_IS_BIT_SET(RCC->BDCR,RCC_BDCR_LSERDY)){frequency=LSE_VALUE;}break;default:break;}break;}#ifdefined(SWPMI1)caseRCC_PERIPHCLK_SWPMI1:{srcclk=__HAL_RCC_GET_SWPMI1_SOURCE();switch(srcclk){caseRCC_SWPMI1CLKSOURCE_PCLK1:frequency=HAL_RCC_GetPCLK1Freq();break;caseRCC_SWPMI1CLKSOURCE_HSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}break;default:break;}break;}#endif#ifdefined(OCTOSPI1)||defined(OCTOSPI2)caseRCC_PERIPHCLK_OSPI:{srcclk=__HAL_RCC_GET_OSPI_SOURCE();switch(srcclk){caseRCC_OSPICLKSOURCE_SYSCLK:frequency=HAL_RCC_GetSysClockFreq();break;caseRCC_OSPICLKSOURCE_MSI:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_MSIRDY)){frequency=MSIRangeTable[(__HAL_RCC_GET_MSI_RANGE()>>4U)];}break;caseRCC_OSPICLKSOURCE_PLL:if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLRDY)){if(HAL_IS_BIT_SET(RCC->PLLCFGR,RCC_PLLCFGR_PLLQEN)){plln=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLN)>>RCC_PLLCFGR_PLLN_Pos;pllvco=((pllvco*plln)/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));frequency=(pllvco/(((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLQ)>>RCC_PLLCFGR_PLLQ_Pos)+1U)<<1U));}}break;default:break;}break;}#endifdefault:break;}}return(frequency);}#ifdefined(RCC_PLLSAI1_SUPPORT)HAL_StatusTypeDefHAL_RCCEx_EnablePLLSAI1(RCC_PLLSAI1InitTypeDef*PLLSAI1Init){uint32_ttickstart;HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_RCC_PLLSAI1SOURCE(PLLSAI1Init->PLLSAI1Source));assert_param(IS_RCC_PLLSAI1M_VALUE(PLLSAI1Init->PLLSAI1M));assert_param(IS_RCC_PLLSAI1N_VALUE(PLLSAI1Init->PLLSAI1N));assert_param(IS_RCC_PLLSAI1P_VALUE(PLLSAI1Init->PLLSAI1P));assert_param(IS_RCC_PLLSAI1Q_VALUE(PLLSAI1Init->PLLSAI1Q));assert_param(IS_RCC_PLLSAI1R_VALUE(PLLSAI1Init->PLLSAI1R));assert_param(IS_RCC_PLLSAI1CLOCKOUT_VALUE(PLLSAI1Init->PLLSAI1ClockOut));__HAL_RCC_PLLSAI1_DISABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI1RDY)!=0U){if((HAL_GetTick()-tickstart)>PLLSAI1_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}if(status==HAL_OK){#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)__HAL_RCC_PLLSAI1_CONFIG(PLLSAI1Init->PLLSAI1M,PLLSAI1Init->PLLSAI1N,PLLSAI1Init->PLLSAI1P,PLLSAI1Init->PLLSAI1Q,PLLSAI1Init->PLLSAI1R);#else__HAL_RCC_PLLSAI1_CONFIG(PLLSAI1Init->PLLSAI1N,PLLSAI1Init->PLLSAI1P,PLLSAI1Init->PLLSAI1Q,PLLSAI1Init->PLLSAI1R);#endif__HAL_RCC_PLLSAI1CLKOUT_ENABLE(PLLSAI1Init->PLLSAI1ClockOut);__HAL_RCC_PLLSAI1_ENABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI1RDY)==0U){if((HAL_GetTick()-tickstart)>PLLSAI1_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}}returnstatus;}HAL_StatusTypeDefHAL_RCCEx_DisablePLLSAI1(void){uint32_ttickstart;HAL_StatusTypeDefstatus=HAL_OK;__HAL_RCC_PLLSAI1_DISABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI1RDY)!=0U){if((HAL_GetTick()-tickstart)>PLLSAI1_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}__HAL_RCC_PLLSAI1CLKOUT_DISABLE(RCC_PLLSAI1CFGR_PLLSAI1PEN|RCC_PLLSAI1CFGR_PLLSAI1QEN|RCC_PLLSAI1CFGR_PLLSAI1REN);#ifdefined(RCC_PLLSAI2_SUPPORT)if(READ_BIT(RCC->CR,(RCC_CR_PLLRDY|RCC_CR_PLLSAI2RDY))==0U){MODIFY_REG(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC,RCC_PLLSOURCE_NONE);}#elseif(READ_BIT(RCC->CR,RCC_CR_PLLRDY)==0U){MODIFY_REG(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC,RCC_PLLSOURCE_NONE);}#endifreturnstatus;}#endif#ifdefined(RCC_PLLSAI2_SUPPORT)HAL_StatusTypeDefHAL_RCCEx_EnablePLLSAI2(RCC_PLLSAI2InitTypeDef*PLLSAI2Init){uint32_ttickstart;HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_RCC_PLLSAI2SOURCE(PLLSAI2Init->PLLSAI2Source));assert_param(IS_RCC_PLLSAI2M_VALUE(PLLSAI2Init->PLLSAI2M));assert_param(IS_RCC_PLLSAI2N_VALUE(PLLSAI2Init->PLLSAI2N));assert_param(IS_RCC_PLLSAI2P_VALUE(PLLSAI2Init->PLLSAI2P));#ifdefined(RCC_PLLSAI2Q_DIV_SUPPORT)assert_param(IS_RCC_PLLSAI2Q_VALUE(PLLSAI2Init->PLLSAI2Q));#endifassert_param(IS_RCC_PLLSAI2R_VALUE(PLLSAI2Init->PLLSAI2R));assert_param(IS_RCC_PLLSAI2CLOCKOUT_VALUE(PLLSAI2Init->PLLSAI2ClockOut));__HAL_RCC_PLLSAI2_DISABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI2RDY)!=0U){if((HAL_GetTick()-tickstart)>PLLSAI2_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}if(status==HAL_OK){#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)&&defined(RCC_PLLSAI2Q_DIV_SUPPORT)__HAL_RCC_PLLSAI2_CONFIG(PLLSAI2Init->PLLSAI2M,PLLSAI2Init->PLLSAI2N,PLLSAI2Init->PLLSAI2P,PLLSAI2Init->PLLSAI2Q,PLLSAI2Init->PLLSAI2R);#elifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)__HAL_RCC_PLLSAI2_CONFIG(PLLSAI2Init->PLLSAI2M,PLLSAI2Init->PLLSAI2N,PLLSAI2Init->PLLSAI2P,PLLSAI2Init->PLLSAI2R);#elifdefined(RCC_PLLSAI2Q_DIV_SUPPORT)__HAL_RCC_PLLSAI2_CONFIG(PLLSAI2Init->PLLSAI2N,PLLSAI2Init->PLLSAI2P,PLLSAI2Init->PLLSAI2Q,PLLSAI2Init->PLLSAI2R);#else__HAL_RCC_PLLSAI2_CONFIG(PLLSAI2Init->PLLSAI2N,PLLSAI2Init->PLLSAI2P,PLLSAI2Init->PLLSAI2R);#endif__HAL_RCC_PLLSAI2CLKOUT_ENABLE(PLLSAI2Init->PLLSAI2ClockOut);__HAL_RCC_PLLSAI2_ENABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI2RDY)==0U){if((HAL_GetTick()-tickstart)>PLLSAI2_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}}returnstatus;}HAL_StatusTypeDefHAL_RCCEx_DisablePLLSAI2(void){uint32_ttickstart;HAL_StatusTypeDefstatus=HAL_OK;__HAL_RCC_PLLSAI2_DISABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI2RDY)!=0U){if((HAL_GetTick()-tickstart)>PLLSAI2_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}#ifdefined(RCC_PLLSAI2Q_DIV_SUPPORT)__HAL_RCC_PLLSAI2CLKOUT_DISABLE(RCC_PLLSAI2CFGR_PLLSAI2PEN|RCC_PLLSAI2CFGR_PLLSAI2QEN|RCC_PLLSAI2CFGR_PLLSAI2REN);#else__HAL_RCC_PLLSAI2CLKOUT_DISABLE(RCC_PLLSAI2CFGR_PLLSAI2PEN|RCC_PLLSAI2CFGR_PLLSAI2REN);#endifif(READ_BIT(RCC->CR,(RCC_CR_PLLRDY|RCC_CR_PLLSAI1RDY))==0U){MODIFY_REG(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC,RCC_PLLSOURCE_NONE);}returnstatus;}#endifvoidHAL_RCCEx_WakeUpStopCLKConfig(uint32_tWakeUpClk){assert_param(IS_RCC_STOP_WAKEUPCLOCK(WakeUpClk));__HAL_RCC_WAKEUPSTOP_CLK_CONFIG(WakeUpClk);}voidHAL_RCCEx_StandbyMSIRangeConfig(uint32_tMSIRange){assert_param(IS_RCC_MSI_STANDBY_CLOCK_RANGE(MSIRange));__HAL_RCC_MSI_STANDBY_RANGE_CONFIG(MSIRange);}voidHAL_RCCEx_EnableLSECSS(void){SET_BIT(RCC->BDCR,RCC_BDCR_LSECSSON);}voidHAL_RCCEx_DisableLSECSS(void){CLEAR_BIT(RCC->BDCR,RCC_BDCR_LSECSSON);__HAL_RCC_DISABLE_IT(RCC_IT_LSECSS);}voidHAL_RCCEx_EnableLSECSS_IT(void){SET_BIT(RCC->BDCR,RCC_BDCR_LSECSSON);__HAL_RCC_ENABLE_IT(RCC_IT_LSECSS);__HAL_RCC_LSECSS_EXTI_ENABLE_IT();__HAL_RCC_LSECSS_EXTI_ENABLE_RISING_EDGE();}voidHAL_RCCEx_LSECSS_IRQHandler(void){if(__HAL_RCC_GET_IT(RCC_IT_LSECSS)){HAL_RCCEx_LSECSS_Callback();__HAL_RCC_CLEAR_IT(RCC_IT_LSECSS);}}__weakvoidHAL_RCCEx_LSECSS_Callback(void){}voidHAL_RCCEx_EnableLSCO(uint32_tLSCOSource){GPIO_InitTypeDefGPIO_InitStruct;FlagStatuspwrclkchanged=RESET;FlagStatusbackupchanged=RESET;assert_param(IS_RCC_LSCOSOURCE(LSCOSource));__LSCO_CLK_ENABLE();GPIO_InitStruct.Pin=LSCO_PIN;GPIO_InitStruct.Mode=GPIO_MODE_ANALOG;GPIO_InitStruct.Speed=GPIO_SPEED_FREQ_HIGH;GPIO_InitStruct.Pull=GPIO_NOPULL;HAL_GPIO_Init(LSCO_GPIO_PORT,&GPIO_InitStruct);if(__HAL_RCC_PWR_IS_CLK_DISABLED()){__HAL_RCC_PWR_CLK_ENABLE();pwrclkchanged=SET;}if(HAL_IS_BIT_CLR(PWR->CR1,PWR_CR1_DBP)){HAL_PWR_EnableBkUpAccess();backupchanged=SET;}MODIFY_REG(RCC->BDCR,RCC_BDCR_LSCOSEL|RCC_BDCR_LSCOEN,LSCOSource|RCC_BDCR_LSCOEN);if(backupchanged==SET){HAL_PWR_DisableBkUpAccess();}if(pwrclkchanged==SET){__HAL_RCC_PWR_CLK_DISABLE();}}voidHAL_RCCEx_DisableLSCO(void){FlagStatuspwrclkchanged=RESET;FlagStatusbackupchanged=RESET;if(__HAL_RCC_PWR_IS_CLK_DISABLED()){__HAL_RCC_PWR_CLK_ENABLE();pwrclkchanged=SET;}if(HAL_IS_BIT_CLR(PWR->CR1,PWR_CR1_DBP)){HAL_PWR_EnableBkUpAccess();backupchanged=SET;}CLEAR_BIT(RCC->BDCR,RCC_BDCR_LSCOEN);if(backupchanged==SET){HAL_PWR_DisableBkUpAccess();}if(pwrclkchanged==SET){__HAL_RCC_PWR_CLK_DISABLE();}}voidHAL_RCCEx_EnableMSIPLLMode(void){SET_BIT(RCC->CR,RCC_CR_MSIPLLEN);}voidHAL_RCCEx_DisableMSIPLLMode(void){CLEAR_BIT(RCC->CR,RCC_CR_MSIPLLEN);}#ifdefined(OCTOSPI1)&&defined(OCTOSPI2)voidHAL_RCCEx_OCTOSPIDelayConfig(uint32_tDelay1,uint32_tDelay2){assert_param(IS_RCC_OCTOSPIDELAY(Delay1));assert_param(IS_RCC_OCTOSPIDELAY(Delay2));MODIFY_REG(RCC->DLYCFGR,RCC_DLYCFGR_OCTOSPI1_DLY|RCC_DLYCFGR_OCTOSPI2_DLY,(Delay1|(Delay2<<RCC_DLYCFGR_OCTOSPI2_DLY_Pos)));}#endif#ifdefined(CRS)voidHAL_RCCEx_CRSConfig(RCC_CRSInitTypeDef*pInit){uint32_tvalue;assert_param(IS_RCC_CRS_SYNC_DIV(pInit->Prescaler));assert_param(IS_RCC_CRS_SYNC_SOURCE(pInit->Source));assert_param(IS_RCC_CRS_SYNC_POLARITY(pInit->Polarity));assert_param(IS_RCC_CRS_RELOADVALUE(pInit->ReloadValue));assert_param(IS_RCC_CRS_ERRORLIMIT(pInit->ErrorLimitValue));assert_param(IS_RCC_CRS_HSI48CALIBRATION(pInit->HSI48CalibrationValue));__HAL_RCC_CRS_FORCE_RESET();__HAL_RCC_CRS_RELEASE_RESET();value=(pInit->Prescaler|pInit->Source|pInit->Polarity);value|=pInit->ReloadValue;value|=(pInit->ErrorLimitValue<<CRS_CFGR_FELIM_Pos);WRITE_REG(CRS->CFGR,value);MODIFY_REG(CRS->CR,CRS_CR_TRIM,(pInit->HSI48CalibrationValue<<CRS_CR_TRIM_Pos));SET_BIT(CRS->CR,CRS_CR_AUTOTRIMEN|CRS_CR_CEN);}voidHAL_RCCEx_CRSSoftwareSynchronizationGenerate(void){SET_BIT(CRS->CR,CRS_CR_SWSYNC);}voidHAL_RCCEx_CRSGetSynchronizationInfo(RCC_CRSSynchroInfoTypeDef*pSynchroInfo){assert_param(pSynchroInfo!=(void*)NULL);pSynchroInfo->ReloadValue=(READ_BIT(CRS->CFGR,CRS_CFGR_RELOAD));pSynchroInfo->HSI48CalibrationValue=(READ_BIT(CRS->CR,CRS_CR_TRIM)>>CRS_CR_TRIM_Pos);pSynchroInfo->FreqErrorCapture=(READ_BIT(CRS->ISR,CRS_ISR_FECAP)>>CRS_ISR_FECAP_Pos);pSynchroInfo->FreqErrorDirection=(READ_BIT(CRS->ISR,CRS_ISR_FEDIR));}uint32_tHAL_RCCEx_CRSWaitSynchronization(uint32_tTimeout){uint32_tcrsstatus=RCC_CRS_NONE;uint32_ttickstart;tickstart=HAL_GetTick();do{if(Timeout!=HAL_MAX_DELAY){if(((HAL_GetTick()-tickstart)>Timeout)||(Timeout==0U)){crsstatus=RCC_CRS_TIMEOUT;}}if(__HAL_RCC_CRS_GET_FLAG(RCC_CRS_FLAG_SYNCOK)){crsstatus|=RCC_CRS_SYNCOK;__HAL_RCC_CRS_CLEAR_FLAG(RCC_CRS_FLAG_SYNCOK);}if(__HAL_RCC_CRS_GET_FLAG(RCC_CRS_FLAG_SYNCWARN)){crsstatus|=RCC_CRS_SYNCWARN;__HAL_RCC_CRS_CLEAR_FLAG(RCC_CRS_FLAG_SYNCWARN);}if(__HAL_RCC_CRS_GET_FLAG(RCC_CRS_FLAG_TRIMOVF)){crsstatus|=RCC_CRS_TRIMOVF;__HAL_RCC_CRS_CLEAR_FLAG(RCC_CRS_FLAG_TRIMOVF);}if(__HAL_RCC_CRS_GET_FLAG(RCC_CRS_FLAG_SYNCERR)){crsstatus|=RCC_CRS_SYNCERR;__HAL_RCC_CRS_CLEAR_FLAG(RCC_CRS_FLAG_SYNCERR);}if(__HAL_RCC_CRS_GET_FLAG(RCC_CRS_FLAG_SYNCMISS)){crsstatus|=RCC_CRS_SYNCMISS;__HAL_RCC_CRS_CLEAR_FLAG(RCC_CRS_FLAG_SYNCMISS);}if(__HAL_RCC_CRS_GET_FLAG(RCC_CRS_FLAG_ESYNC)){__HAL_RCC_CRS_CLEAR_FLAG(RCC_CRS_FLAG_ESYNC);}}while(RCC_CRS_NONE==crsstatus);returncrsstatus;}voidHAL_RCCEx_CRS_IRQHandler(void){uint32_tcrserror=RCC_CRS_NONE;uint32_titflags=READ_REG(CRS->ISR);uint32_titsources=READ_REG(CRS->CR);if(((itflags&RCC_CRS_FLAG_SYNCOK)!=0U)&&((itsources&RCC_CRS_IT_SYNCOK)!=0U)){WRITE_REG(CRS->ICR,CRS_ICR_SYNCOKC);HAL_RCCEx_CRS_SyncOkCallback();}elseif(((itflags&RCC_CRS_FLAG_SYNCWARN)!=0U)&&((itsources&RCC_CRS_IT_SYNCWARN)!=0U)){WRITE_REG(CRS->ICR,CRS_ICR_SYNCWARNC);HAL_RCCEx_CRS_SyncWarnCallback();}elseif(((itflags&RCC_CRS_FLAG_ESYNC)!=0U)&&((itsources&RCC_CRS_IT_ESYNC)!=0U)){WRITE_REG(CRS->ICR,CRS_ICR_ESYNCC);HAL_RCCEx_CRS_ExpectedSyncCallback();}else{if(((itflags&RCC_CRS_FLAG_ERR)!=0U)&&((itsources&RCC_CRS_IT_ERR)!=0U)){if((itflags&RCC_CRS_FLAG_SYNCERR)!=0U){crserror|=RCC_CRS_SYNCERR;}if((itflags&RCC_CRS_FLAG_SYNCMISS)!=0U){crserror|=RCC_CRS_SYNCMISS;}if((itflags&RCC_CRS_FLAG_TRIMOVF)!=0U){crserror|=RCC_CRS_TRIMOVF;}WRITE_REG(CRS->ICR,CRS_ICR_ERRC);HAL_RCCEx_CRS_ErrorCallback(crserror);}}}__weakvoidHAL_RCCEx_CRS_SyncOkCallback(void){}__weakvoidHAL_RCCEx_CRS_SyncWarnCallback(void){}__weakvoidHAL_RCCEx_CRS_ExpectedSyncCallback(void){}__weakvoidHAL_RCCEx_CRS_ErrorCallback(uint32_tError){UNUSED(Error);}#endif#ifdefined(RCC_PLLSAI1_SUPPORT)staticHAL_StatusTypeDefRCCEx_PLLSAI1_Config(RCC_PLLSAI1InitTypeDef*PllSai1,uint32_tDivider){uint32_ttickstart;HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_RCC_PLLSAI1SOURCE(PllSai1->PLLSAI1Source));assert_param(IS_RCC_PLLSAI1M_VALUE(PllSai1->PLLSAI1M));assert_param(IS_RCC_PLLSAI1N_VALUE(PllSai1->PLLSAI1N));assert_param(IS_RCC_PLLSAI1CLOCKOUT_VALUE(PllSai1->PLLSAI1ClockOut));if(__HAL_RCC_GET_PLL_OSCSOURCE()!=RCC_PLLSOURCE_NONE){if((__HAL_RCC_GET_PLL_OSCSOURCE()!=PllSai1->PLLSAI1Source)||(PllSai1->PLLSAI1Source==RCC_PLLSOURCE_NONE)#if!defined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)||(((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U)!=PllSai1->PLLSAI1M)#endif){status=HAL_ERROR;}}else{switch(PllSai1->PLLSAI1Source){caseRCC_PLLSOURCE_MSI:if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_MSIRDY)){status=HAL_ERROR;}break;caseRCC_PLLSOURCE_HSI:if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_HSIRDY)){status=HAL_ERROR;}break;caseRCC_PLLSOURCE_HSE:if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_HSERDY)){if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_HSEBYP)){status=HAL_ERROR;}}break;default:status=HAL_ERROR;break;}if(status==HAL_OK){#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)MODIFY_REG(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC,PllSai1->PLLSAI1Source);#elseMODIFY_REG(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC|RCC_PLLCFGR_PLLM,PllSai1->PLLSAI1Source|(PllSai1->PLLSAI1M-1U)<<RCC_PLLCFGR_PLLM_Pos);#endif}}if(status==HAL_OK){__HAL_RCC_PLLSAI1_DISABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI1RDY)!=0U){if((HAL_GetTick()-tickstart)>PLLSAI1_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}if(status==HAL_OK){if(Divider==DIVIDER_P_UPDATE){assert_param(IS_RCC_PLLSAI1P_VALUE(PllSai1->PLLSAI1P));#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)#ifdefined(RCC_PLLSAI1P_DIV_2_31_SUPPORT)MODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1PDIV|RCC_PLLSAI1CFGR_PLLSAI1M,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|(PllSai1->PLLSAI1P<<RCC_PLLSAI1CFGR_PLLSAI1PDIV_Pos)|((PllSai1->PLLSAI1M-1U)<<RCC_PLLSAI1CFGR_PLLSAI1M_Pos));#elseMODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1P|RCC_PLLSAI1CFGR_PLLSAI1M,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|((PllSai1->PLLSAI1P>>4U)<<RCC_PLLSAI1CFGR_PLLSAI1P_Pos)|((PllSai1->PLLSAI1M-1U)<<RCC_PLLSAI1CFGR_PLLSAI1M_Pos));#endif#else#ifdefined(RCC_PLLSAI1P_DIV_2_31_SUPPORT)MODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1PDIV,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|(PllSai1->PLLSAI1P<<RCC_PLLSAI1CFGR_PLLSAI1PDIV_Pos));#elseMODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1P,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|((PllSai1->PLLSAI1P>>4U)<<RCC_PLLSAI1CFGR_PLLSAI1P_Pos));#endif#endif}elseif(Divider==DIVIDER_Q_UPDATE){assert_param(IS_RCC_PLLSAI1Q_VALUE(PllSai1->PLLSAI1Q));#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)MODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1Q|RCC_PLLSAI1CFGR_PLLSAI1M,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|(((PllSai1->PLLSAI1Q>>1U)-1U)<<RCC_PLLSAI1CFGR_PLLSAI1Q_Pos)|((PllSai1->PLLSAI1M-1U)<<RCC_PLLSAI1CFGR_PLLSAI1M_Pos));#elseMODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1Q,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|(((PllSai1->PLLSAI1Q>>1U)-1U)<<RCC_PLLSAI1CFGR_PLLSAI1Q_Pos));#endif}else{assert_param(IS_RCC_PLLSAI1R_VALUE(PllSai1->PLLSAI1R));#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)MODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1R|RCC_PLLSAI1CFGR_PLLSAI1M,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|(((PllSai1->PLLSAI1R>>1U)-1U)<<RCC_PLLSAI1CFGR_PLLSAI1R_Pos)|((PllSai1->PLLSAI1M-1U)<<RCC_PLLSAI1CFGR_PLLSAI1M_Pos));#elseMODIFY_REG(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N|RCC_PLLSAI1CFGR_PLLSAI1R,(PllSai1->PLLSAI1N<<RCC_PLLSAI1CFGR_PLLSAI1N_Pos)|(((PllSai1->PLLSAI1R>>1U)-1U)<<RCC_PLLSAI1CFGR_PLLSAI1R_Pos));#endif}__HAL_RCC_PLLSAI1_ENABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI1RDY)==0U){if((HAL_GetTick()-tickstart)>PLLSAI1_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}if(status==HAL_OK){__HAL_RCC_PLLSAI1CLKOUT_ENABLE(PllSai1->PLLSAI1ClockOut);}}}returnstatus;}#endif#ifdefined(RCC_PLLSAI2_SUPPORT)staticHAL_StatusTypeDefRCCEx_PLLSAI2_Config(RCC_PLLSAI2InitTypeDef*PllSai2,uint32_tDivider){uint32_ttickstart;HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_RCC_PLLSAI2SOURCE(PllSai2->PLLSAI2Source));assert_param(IS_RCC_PLLSAI2M_VALUE(PllSai2->PLLSAI2M));assert_param(IS_RCC_PLLSAI2N_VALUE(PllSai2->PLLSAI2N));assert_param(IS_RCC_PLLSAI2CLOCKOUT_VALUE(PllSai2->PLLSAI2ClockOut));if(__HAL_RCC_GET_PLL_OSCSOURCE()!=RCC_PLLSOURCE_NONE){if((__HAL_RCC_GET_PLL_OSCSOURCE()!=PllSai2->PLLSAI2Source)||(PllSai2->PLLSAI2Source==RCC_PLLSOURCE_NONE)#if!defined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)||(((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U)!=PllSai2->PLLSAI2M)#endif){status=HAL_ERROR;}}else{switch(PllSai2->PLLSAI2Source){caseRCC_PLLSOURCE_MSI:if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_MSIRDY)){status=HAL_ERROR;}break;caseRCC_PLLSOURCE_HSI:if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_HSIRDY)){status=HAL_ERROR;}break;caseRCC_PLLSOURCE_HSE:if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_HSERDY)){if(HAL_IS_BIT_CLR(RCC->CR,RCC_CR_HSEBYP)){status=HAL_ERROR;}}break;default:status=HAL_ERROR;break;}if(status==HAL_OK){#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)MODIFY_REG(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC,PllSai2->PLLSAI2Source);#elseMODIFY_REG(RCC->PLLCFGR,RCC_PLLCFGR_PLLSRC|RCC_PLLCFGR_PLLM,PllSai2->PLLSAI2Source|(PllSai2->PLLSAI2M-1U)<<RCC_PLLCFGR_PLLM_Pos);#endif}}if(status==HAL_OK){__HAL_RCC_PLLSAI2_DISABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI2RDY)!=0U){if((HAL_GetTick()-tickstart)>PLLSAI2_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}if(status==HAL_OK){if(Divider==DIVIDER_P_UPDATE){assert_param(IS_RCC_PLLSAI2P_VALUE(PllSai2->PLLSAI2P));#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)#ifdefined(RCC_PLLSAI2P_DIV_2_31_SUPPORT)MODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2PDIV|RCC_PLLSAI2CFGR_PLLSAI2M,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|(PllSai2->PLLSAI2P<<RCC_PLLSAI2CFGR_PLLSAI2PDIV_Pos)|((PllSai2->PLLSAI2M-1U)<<RCC_PLLSAI2CFGR_PLLSAI2M_Pos));#elseMODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2P|RCC_PLLSAI2CFGR_PLLSAI2M,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|((PllSai2->PLLSAI2P>>4U)<<RCC_PLLSAI2CFGR_PLLSAI2P_Pos)|((PllSai2->PLLSAI2M-1U)<<RCC_PLLSAI2CFGR_PLLSAI2M_Pos));#endif#else#ifdefined(RCC_PLLSAI2P_DIV_2_31_SUPPORT)MODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2PDIV,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|(PllSai2->PLLSAI2P<<RCC_PLLSAI2CFGR_PLLSAI2PDIV_Pos));#elseMODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2P,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|((PllSai2->PLLSAI2P>>4U)<<RCC_PLLSAI2CFGR_PLLSAI2P_Pos));#endif#endif}#ifdefined(RCC_PLLSAI2Q_DIV_SUPPORT)elseif(Divider==DIVIDER_Q_UPDATE){assert_param(IS_RCC_PLLSAI2Q_VALUE(PllSai2->PLLSAI2Q));#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)MODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2Q|RCC_PLLSAI2CFGR_PLLSAI2M,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|(((PllSai2->PLLSAI2Q>>1U)-1U)<<RCC_PLLSAI2CFGR_PLLSAI2Q_Pos)|((PllSai2->PLLSAI2M-1U)<<RCC_PLLSAI2CFGR_PLLSAI2M_Pos));#elseMODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2Q,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|(((PllSai2->PLLSAI2Q>>1U)-1U)<<RCC_PLLSAI2CFGR_PLLSAI2Q_Pos));#endif}#endifelse{assert_param(IS_RCC_PLLSAI2R_VALUE(PllSai2->PLLSAI2R));#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)MODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2R|RCC_PLLSAI2CFGR_PLLSAI2M,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|(((PllSai2->PLLSAI2R>>1U)-1U)<<RCC_PLLSAI2CFGR_PLLSAI2R_Pos)|((PllSai2->PLLSAI2M-1U)<<RCC_PLLSAI2CFGR_PLLSAI2M_Pos));#elseMODIFY_REG(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N|RCC_PLLSAI2CFGR_PLLSAI2R,(PllSai2->PLLSAI2N<<RCC_PLLSAI2CFGR_PLLSAI2N_Pos)|(((PllSai2->PLLSAI2R>>1U)-1U)<<RCC_PLLSAI2CFGR_PLLSAI2R_Pos));#endif}__HAL_RCC_PLLSAI2_ENABLE();tickstart=HAL_GetTick();while(READ_BIT(RCC->CR,RCC_CR_PLLSAI2RDY)==0U){if((HAL_GetTick()-tickstart)>PLLSAI2_TIMEOUT_VALUE){status=HAL_TIMEOUT;break;}}if(status==HAL_OK){__HAL_RCC_PLLSAI2CLKOUT_ENABLE(PllSai2->PLLSAI2ClockOut);}}}returnstatus;}#endif#ifdefined(SAI1)staticuint32_tRCCEx_GetSAIxPeriphCLKFreq(uint32_tPeriphClk,uint32_tInputFrequency){uint32_tfrequency=0U;uint32_tsrcclk=0U;uint32_tpllvco,plln;#ifdefined(RCC_PLLP_SUPPORT)uint32_tpllp=0U;#endifif(PeriphClk==RCC_PERIPHCLK_SAI1){srcclk=__HAL_RCC_GET_SAI1_SOURCE();if(srcclk==RCC_SAI1CLKSOURCE_PIN){frequency=EXTERNAL_SAI1_CLOCK_VALUE;}}#ifdefined(SAI2)else{if(PeriphClk==RCC_PERIPHCLK_SAI2){srcclk=__HAL_RCC_GET_SAI2_SOURCE();if(srcclk==RCC_SAI2CLKSOURCE_PIN){frequency=EXTERNAL_SAI2_CLOCK_VALUE;}}}#endifif(frequency==0U){pllvco=InputFrequency;#ifdefined(SAI2)if((srcclk==RCC_SAI1CLKSOURCE_PLL)||(srcclk==RCC_SAI2CLKSOURCE_PLL)){if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLRDY)&&(__HAL_RCC_GET_PLLCLKOUT_CONFIG(RCC_PLL_SAI3CLK)!=0U)){pllvco=(pllvco/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));plln=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLN)>>RCC_PLLCFGR_PLLN_Pos;#ifdefined(RCC_PLLP_DIV_2_31_SUPPORT)pllp=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLPDIV)>>RCC_PLLCFGR_PLLPDIV_Pos;#endifif(pllp==0U){if(READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLP)!=0U){pllp=17U;}else{pllp=7U;}}frequency=(pllvco*plln)/pllp;}}elseif(srcclk==0U){if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLSAI1RDY)&&(__HAL_RCC_GET_PLLSAI1CLKOUT_CONFIG(RCC_PLLSAI1_SAI1CLK)!=0U)){#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)pllvco=(pllvco/((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1M)>>RCC_PLLSAI1CFGR_PLLSAI1M_Pos)+1U));#elsepllvco=(pllvco/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));#endifplln=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N)>>RCC_PLLSAI1CFGR_PLLSAI1N_Pos;#ifdefined(RCC_PLLSAI1P_DIV_2_31_SUPPORT)pllp=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1PDIV)>>RCC_PLLSAI1CFGR_PLLSAI1PDIV_Pos;#endifif(pllp==0U){if(READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1P)!=0U){pllp=17U;}else{pllp=7U;}}frequency=(pllvco*plln)/pllp;}}#ifdefined(STM32L4P5xx)||defined(STM32L4Q5xx)||defined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)elseif((srcclk==RCC_SAI1CLKSOURCE_HSI)||(srcclk==RCC_SAI2CLKSOURCE_HSI)){if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}}#endif#elseif(srcclk==RCC_SAI1CLKSOURCE_PLL){if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLRDY)&&(__HAL_RCC_GET_PLLCLKOUT_CONFIG(RCC_PLL_SAI2CLK)!=0U)){pllvco=(pllvco/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));plln=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLN)>>RCC_PLLCFGR_PLLN_Pos;#ifdefined(RCC_PLLP_DIV_2_31_SUPPORT)pllp=READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLPDIV)>>RCC_PLLCFGR_PLLPDIV_Pos;#endifif(pllp==0U){if(READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLP)!=0U){pllp=17U;}else{pllp=7U;}}frequency=(pllvco*plln)/pllp;}elseif(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}else{}}elseif(srcclk==RCC_SAI1CLKSOURCE_PLLSAI1){if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLSAI1RDY)&&(__HAL_RCC_GET_PLLSAI1CLKOUT_CONFIG(RCC_PLLSAI1_SAI1CLK)!=0U)){#ifdefined(RCC_PLLSAI1M_DIV_1_16_SUPPORT)pllvco=(pllvco/((READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1M)>>RCC_PLLSAI1CFGR_PLLSAI1M_Pos)+1U));#elsepllvco=(pllvco/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));#endifplln=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1N)>>RCC_PLLSAI1CFGR_PLLSAI1N_Pos;#ifdefined(RCC_PLLSAI1P_DIV_2_31_SUPPORT)pllp=READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1PDIV)>>RCC_PLLSAI1CFGR_PLLSAI1PDIV_Pos;#endifif(pllp==0U){if(READ_BIT(RCC->PLLSAI1CFGR,RCC_PLLSAI1CFGR_PLLSAI1P)!=0U){pllp=17U;}else{pllp=7U;}}frequency=(pllvco*plln)/pllp;}elseif(HAL_IS_BIT_SET(RCC->CR,RCC_CR_HSIRDY)){frequency=HSI_VALUE;}else{}}#endif#ifdefined(RCC_PLLSAI2_SUPPORT)elseif((srcclk==RCC_SAI1CLKSOURCE_PLLSAI2)||(srcclk==RCC_SAI2CLKSOURCE_PLLSAI2)){if(HAL_IS_BIT_SET(RCC->CR,RCC_CR_PLLSAI2RDY)&&(__HAL_RCC_GET_PLLSAI2CLKOUT_CONFIG(RCC_PLLSAI2_SAI2CLK)!=0U)){#ifdefined(RCC_PLLSAI2M_DIV_1_16_SUPPORT)pllvco=(pllvco/((READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2M)>>RCC_PLLSAI2CFGR_PLLSAI2M_Pos)+1U));#elsepllvco=(pllvco/((READ_BIT(RCC->PLLCFGR,RCC_PLLCFGR_PLLM)>>RCC_PLLCFGR_PLLM_Pos)+1U));#endifplln=READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2N)>>RCC_PLLSAI2CFGR_PLLSAI2N_Pos;#ifdefined(RCC_PLLSAI2P_DIV_2_31_SUPPORT)pllp=READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2PDIV)>>RCC_PLLSAI2CFGR_PLLSAI2PDIV_Pos;#endifif(pllp==0U){if(READ_BIT(RCC->PLLSAI2CFGR,RCC_PLLSAI2CFGR_PLLSAI2P)!=0U){pllp=17U;}else{pllp=7U;}}frequency=(pllvco*plln)/pllp;}}#endifelse{}}returnfrequency;}#endif#endif