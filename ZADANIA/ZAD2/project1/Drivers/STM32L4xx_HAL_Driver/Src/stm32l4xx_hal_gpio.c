#include"stm32l4xx_hal.h"#ifdefHAL_GPIO_MODULE_ENABLED#defineGPIO_NUMBER(16u)voidHAL_GPIO_Init(GPIO_TypeDef*GPIOx,GPIO_InitTypeDef*GPIO_Init){uint32_tposition=0x00u;uint32_tiocurrent;uint32_ttemp;assert_param(IS_GPIO_ALL_INSTANCE(GPIOx));assert_param(IS_GPIO_PIN(GPIO_Init->Pin));assert_param(IS_GPIO_MODE(GPIO_Init->Mode));while(((GPIO_Init->Pin)>>position)!=0x00u){iocurrent=(GPIO_Init->Pin)&(1uL<<position);if(iocurrent!=0x00u){if(((GPIO_Init->Mode&GPIO_MODE)==MODE_OUTPUT)||((GPIO_Init->Mode&GPIO_MODE)==MODE_AF)){assert_param(IS_GPIO_SPEED(GPIO_Init->Speed));temp=GPIOx->OSPEEDR;temp&=~(GPIO_OSPEEDR_OSPEED0<<(position*2u));temp|=(GPIO_Init->Speed<<(position*2u));GPIOx->OSPEEDR=temp;temp=GPIOx->OTYPER;temp&=~(GPIO_OTYPER_OT0<<position);temp|=(((GPIO_Init->Mode&OUTPUT_TYPE)>>OUTPUT_TYPE_Pos)<<position);GPIOx->OTYPER=temp;}#ifdefined(STM32L471xx)||defined(STM32L475xx)||defined(STM32L476xx)||defined(STM32L485xx)||defined(STM32L486xx)if((GPIO_Init->Mode&GPIO_MODE_ANALOG)==GPIO_MODE_ANALOG){temp=GPIOx->ASCR;temp&=~(GPIO_ASCR_ASC0<<position);temp|=(((GPIO_Init->Mode&GPIO_MODE_ANALOG_ADC_CONTROL)>>3)<<position);GPIOx->ASCR=temp;}#endifif((GPIO_Init->Mode&GPIO_MODE)!=MODE_ANALOG){assert_param(IS_GPIO_PULL(GPIO_Init->Pull));temp=GPIOx->PUPDR;temp&=~(GPIO_PUPDR_PUPD0<<(position*2U));temp|=((GPIO_Init->Pull)<<(position*2U));GPIOx->PUPDR=temp;}if((GPIO_Init->Mode&GPIO_MODE)==MODE_AF){assert_param(IS_GPIO_AF_INSTANCE(GPIOx));assert_param(IS_GPIO_AF(GPIO_Init->Alternate));temp=GPIOx->AFR[position>>3u];temp&=~(0xFu<<((position&0x07u)*4u));temp|=((GPIO_Init->Alternate)<<((position&0x07u)*4u));GPIOx->AFR[position>>3u]=temp;}temp=GPIOx->MODER;temp&=~(GPIO_MODER_MODE0<<(position*2u));temp|=((GPIO_Init->Mode&GPIO_MODE)<<(position*2u));GPIOx->MODER=temp;if((GPIO_Init->Mode&EXTI_MODE)!=0x00u){__HAL_RCC_SYSCFG_CLK_ENABLE();temp=SYSCFG->EXTICR[position>>2u];temp&=~(0x0FuL<<(4u*(position&0x03u)));temp|=(GPIO_GET_INDEX(GPIOx)<<(4u*(position&0x03u)));SYSCFG->EXTICR[position>>2u]=temp;temp=EXTI->RTSR1;temp&=~(iocurrent);if((GPIO_Init->Mode&TRIGGER_RISING)!=0x00u){temp|=iocurrent;}EXTI->RTSR1=temp;temp=EXTI->FTSR1;temp&=~(iocurrent);if((GPIO_Init->Mode&TRIGGER_FALLING)!=0x00u){temp|=iocurrent;}EXTI->FTSR1=temp;temp=EXTI->EMR1;temp&=~(iocurrent);if((GPIO_Init->Mode&EXTI_EVT)!=0x00u){temp|=iocurrent;}EXTI->EMR1=temp;temp=EXTI->IMR1;temp&=~(iocurrent);if((GPIO_Init->Mode&EXTI_IT)!=0x00u){temp|=iocurrent;}EXTI->IMR1=temp;}}position++;}}voidHAL_GPIO_DeInit(GPIO_TypeDef*GPIOx,uint32_tGPIO_Pin){uint32_tposition=0x00u;uint32_tiocurrent;uint32_ttmp;assert_param(IS_GPIO_ALL_INSTANCE(GPIOx));assert_param(IS_GPIO_PIN(GPIO_Pin));while((GPIO_Pin>>position)!=0x00u){iocurrent=(GPIO_Pin)&(1uL<<position);if(iocurrent!=0x00u){tmp=SYSCFG->EXTICR[position>>2u];tmp&=(0x0FuL<<(4u*(position&0x03u)));if(tmp==(GPIO_GET_INDEX(GPIOx)<<(4u*(position&0x03u)))){EXTI->IMR1&=~(iocurrent);EXTI->EMR1&=~(iocurrent);EXTI->FTSR1&=~(iocurrent);EXTI->RTSR1&=~(iocurrent);tmp=0x0FuL<<(4u*(position&0x03u));SYSCFG->EXTICR[position>>2u]&=~tmp;}GPIOx->MODER|=(GPIO_MODER_MODE0<<(position*2u));GPIOx->AFR[position>>3u]&=~(0xFu<<((position&0x07u)*4u));GPIOx->OSPEEDR&=~(GPIO_OSPEEDR_OSPEED0<<(position*2u));GPIOx->OTYPER&=~(GPIO_OTYPER_OT0<<position);GPIOx->PUPDR&=~(GPIO_PUPDR_PUPD0<<(position*2u));#ifdefined(STM32L471xx)||defined(STM32L475xx)||defined(STM32L476xx)||defined(STM32L485xx)||defined(STM32L486xx)GPIOx->ASCR&=~(GPIO_ASCR_ASC0<<position);#endif}position++;}}GPIO_PinStateHAL_GPIO_ReadPin(GPIO_TypeDef*GPIOx,uint16_tGPIO_Pin){GPIO_PinStatebitstatus;assert_param(IS_GPIO_PIN(GPIO_Pin));if((GPIOx->IDR&GPIO_Pin)!=0x00u){bitstatus=GPIO_PIN_SET;}else{bitstatus=GPIO_PIN_RESET;}returnbitstatus;}voidHAL_GPIO_WritePin(GPIO_TypeDef*GPIOx,uint16_tGPIO_Pin,GPIO_PinStatePinState){assert_param(IS_GPIO_PIN(GPIO_Pin));assert_param(IS_GPIO_PIN_ACTION(PinState));if(PinState!=GPIO_PIN_RESET){GPIOx->BSRR=(uint32_t)GPIO_Pin;}else{GPIOx->BRR=(uint32_t)GPIO_Pin;}}voidHAL_GPIO_TogglePin(GPIO_TypeDef*GPIOx,uint16_tGPIO_Pin){uint32_todr;assert_param(IS_GPIO_PIN(GPIO_Pin));odr=GPIOx->ODR;GPIOx->BSRR=((odr&GPIO_Pin)<<GPIO_NUMBER)|(~odr&GPIO_Pin);}HAL_StatusTypeDefHAL_GPIO_LockPin(GPIO_TypeDef*GPIOx,uint16_tGPIO_Pin){__IOuint32_ttmp=GPIO_LCKR_LCKK;assert_param(IS_GPIO_LOCK_INSTANCE(GPIOx));assert_param(IS_GPIO_PIN(GPIO_Pin));tmp|=GPIO_Pin;GPIOx->LCKR=tmp;GPIOx->LCKR=GPIO_Pin;GPIOx->LCKR=tmp;tmp=GPIOx->LCKR;if((GPIOx->LCKR&GPIO_LCKR_LCKK)!=0x00u){returnHAL_OK;}else{returnHAL_ERROR;}}voidHAL_GPIO_EXTI_IRQHandler(uint16_tGPIO_Pin){if(__HAL_GPIO_EXTI_GET_IT(GPIO_Pin)!=0x00u){__HAL_GPIO_EXTI_CLEAR_IT(GPIO_Pin);HAL_GPIO_EXTI_Callback(GPIO_Pin);}}__weakvoidHAL_GPIO_EXTI_Callback(uint16_tGPIO_Pin){UNUSED(GPIO_Pin);}#endif