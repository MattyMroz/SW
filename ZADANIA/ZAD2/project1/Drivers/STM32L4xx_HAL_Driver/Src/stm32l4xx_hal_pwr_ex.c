#include"stm32l4xx_hal.h"#ifdefHAL_PWR_MODULE_ENABLED#ifdefined(STM32L412xx)||defined(STM32L422xx)||defined(STM32L431xx)||defined(STM32L432xx)||defined(STM32L433xx)||defined(STM32L442xx)||defined(STM32L443xx)#definePWR_PORTH_AVAILABLE_PINS((uint32_t)0x0000000B)#elifdefined(STM32L451xx)||defined(STM32L452xx)||defined(STM32L462xx)#definePWR_PORTH_AVAILABLE_PINS((uint32_t)0x0000000B)#elifdefined(STM32L471xx)||defined(STM32L475xx)||defined(STM32L476xx)||defined(STM32L485xx)||defined(STM32L486xx)#definePWR_PORTH_AVAILABLE_PINS((uint32_t)0x00000003)#elifdefined(STM32L496xx)||defined(STM32L4A6xx)||defined(STM32L4P5xx)||defined(STM32L4Q5xx)||defined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)#definePWR_PORTH_AVAILABLE_PINS((uint32_t)0x0000FFFF)#endif#ifdefined(STM32L496xx)||defined(STM32L4A6xx)||defined(STM32L4P5xx)||defined(STM32L4Q5xx)||defined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)#definePWR_PORTI_AVAILABLE_PINS((uint32_t)0x00000FFF)#endif#definePVM_MODE_IT((uint32_t)0x00010000)#definePVM_MODE_EVT((uint32_t)0x00020000)#definePVM_RISING_EDGE((uint32_t)0x00000001)#definePVM_FALLING_EDGE((uint32_t)0x00000002)#definePWR_FLAG_SETTING_DELAY_US50ULuint32_tHAL_PWREx_GetVoltageRange(void){#ifdefined(PWR_CR5_R1MODE)if(READ_BIT(PWR->CR1,PWR_CR1_VOS)==PWR_REGULATOR_VOLTAGE_SCALE2){returnPWR_REGULATOR_VOLTAGE_SCALE2;}elseif(READ_BIT(PWR->CR5,PWR_CR5_R1MODE)==PWR_CR5_R1MODE){returnPWR_REGULATOR_VOLTAGE_SCALE1;}else{returnPWR_REGULATOR_VOLTAGE_SCALE1_BOOST;}#elsereturn(PWR->CR1&PWR_CR1_VOS);#endif}HAL_StatusTypeDefHAL_PWREx_ControlVoltageScaling(uint32_tVoltageScaling){uint32_twait_loop_index;assert_param(IS_PWR_VOLTAGE_SCALING_RANGE(VoltageScaling));#ifdefined(PWR_CR5_R1MODE)if(VoltageScaling==PWR_REGULATOR_VOLTAGE_SCALE1_BOOST){if(READ_BIT(PWR->CR1,PWR_CR1_VOS)==PWR_REGULATOR_VOLTAGE_SCALE2){CLEAR_BIT(PWR->CR5,PWR_CR5_R1MODE);MODIFY_REG(PWR->CR1,PWR_CR1_VOS,PWR_REGULATOR_VOLTAGE_SCALE1);wait_loop_index=((PWR_FLAG_SETTING_DELAY_US*SystemCoreClock)/1000000U)+1;while((HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_VOSF))&&(wait_loop_index!=0U)){wait_loop_index--;}if(HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_VOSF)){returnHAL_TIMEOUT;}}else{CLEAR_BIT(PWR->CR5,PWR_CR5_R1MODE);}}elseif(VoltageScaling==PWR_REGULATOR_VOLTAGE_SCALE1){if(READ_BIT(PWR->CR1,PWR_CR1_VOS)==PWR_REGULATOR_VOLTAGE_SCALE2){SET_BIT(PWR->CR5,PWR_CR5_R1MODE);MODIFY_REG(PWR->CR1,PWR_CR1_VOS,PWR_REGULATOR_VOLTAGE_SCALE1);wait_loop_index=((PWR_FLAG_SETTING_DELAY_US*SystemCoreClock)/1000000U)+1;while((HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_VOSF))&&(wait_loop_index!=0U)){wait_loop_index--;}if(HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_VOSF)){returnHAL_TIMEOUT;}}else{SET_BIT(PWR->CR5,PWR_CR5_R1MODE);}}else{MODIFY_REG(PWR->CR1,PWR_CR1_VOS,PWR_REGULATOR_VOLTAGE_SCALE2);}#elseif(VoltageScaling==PWR_REGULATOR_VOLTAGE_SCALE1){if(READ_BIT(PWR->CR1,PWR_CR1_VOS)!=PWR_REGULATOR_VOLTAGE_SCALE1){MODIFY_REG(PWR->CR1,PWR_CR1_VOS,PWR_REGULATOR_VOLTAGE_SCALE1);wait_loop_index=((PWR_FLAG_SETTING_DELAY_US*SystemCoreClock)/1000000U)+1U;while((HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_VOSF))&&(wait_loop_index!=0U)){wait_loop_index--;}if(HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_VOSF)){returnHAL_TIMEOUT;}}}else{if(READ_BIT(PWR->CR1,PWR_CR1_VOS)!=PWR_REGULATOR_VOLTAGE_SCALE2){MODIFY_REG(PWR->CR1,PWR_CR1_VOS,PWR_REGULATOR_VOLTAGE_SCALE2);}}#endifreturnHAL_OK;}voidHAL_PWREx_EnableBatteryCharging(uint32_tResistorSelection){assert_param(IS_PWR_BATTERY_RESISTOR_SELECT(ResistorSelection));MODIFY_REG(PWR->CR4,PWR_CR4_VBRS,ResistorSelection);SET_BIT(PWR->CR4,PWR_CR4_VBE);}voidHAL_PWREx_DisableBatteryCharging(void){CLEAR_BIT(PWR->CR4,PWR_CR4_VBE);}#ifdefined(PWR_CR2_USV)voidHAL_PWREx_EnableVddUSB(void){SET_BIT(PWR->CR2,PWR_CR2_USV);}voidHAL_PWREx_DisableVddUSB(void){CLEAR_BIT(PWR->CR2,PWR_CR2_USV);}#endif#ifdefined(PWR_CR2_IOSV)voidHAL_PWREx_EnableVddIO2(void){SET_BIT(PWR->CR2,PWR_CR2_IOSV);}voidHAL_PWREx_DisableVddIO2(void){CLEAR_BIT(PWR->CR2,PWR_CR2_IOSV);}#endifvoidHAL_PWREx_EnableInternalWakeUpLine(void){SET_BIT(PWR->CR3,PWR_CR3_EIWF);}voidHAL_PWREx_DisableInternalWakeUpLine(void){CLEAR_BIT(PWR->CR3,PWR_CR3_EIWF);}HAL_StatusTypeDefHAL_PWREx_EnableGPIOPullUp(uint32_tGPIO,uint32_tGPIONumber){HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_PWR_GPIO(GPIO));assert_param(IS_PWR_GPIO_BIT_NUMBER(GPIONumber));switch(GPIO){casePWR_GPIO_A:SET_BIT(PWR->PUCRA,(GPIONumber&(~(PWR_GPIO_BIT_14))));CLEAR_BIT(PWR->PDCRA,(GPIONumber&(~(PWR_GPIO_BIT_13|PWR_GPIO_BIT_15))));break;casePWR_GPIO_B:SET_BIT(PWR->PUCRB,GPIONumber);CLEAR_BIT(PWR->PDCRB,(GPIONumber&(~(PWR_GPIO_BIT_4))));break;casePWR_GPIO_C:SET_BIT(PWR->PUCRC,GPIONumber);CLEAR_BIT(PWR->PDCRC,GPIONumber);break;#ifdefined(GPIOD)casePWR_GPIO_D:SET_BIT(PWR->PUCRD,GPIONumber);CLEAR_BIT(PWR->PDCRD,GPIONumber);break;#endif#ifdefined(GPIOE)casePWR_GPIO_E:SET_BIT(PWR->PUCRE,GPIONumber);CLEAR_BIT(PWR->PDCRE,GPIONumber);break;#endif#ifdefined(GPIOF)casePWR_GPIO_F:SET_BIT(PWR->PUCRF,GPIONumber);CLEAR_BIT(PWR->PDCRF,GPIONumber);break;#endif#ifdefined(GPIOG)casePWR_GPIO_G:SET_BIT(PWR->PUCRG,GPIONumber);CLEAR_BIT(PWR->PDCRG,GPIONumber);break;#endifcasePWR_GPIO_H:SET_BIT(PWR->PUCRH,(GPIONumber&PWR_PORTH_AVAILABLE_PINS));#ifdefined(STM32L496xx)||defined(STM32L4A6xx)CLEAR_BIT(PWR->PDCRH,((GPIONumber&PWR_PORTH_AVAILABLE_PINS)&(~(PWR_GPIO_BIT_3))));#elseCLEAR_BIT(PWR->PDCRH,(GPIONumber&PWR_PORTH_AVAILABLE_PINS));#endifbreak;#ifdefined(GPIOI)casePWR_GPIO_I:SET_BIT(PWR->PUCRI,(GPIONumber&PWR_PORTI_AVAILABLE_PINS));CLEAR_BIT(PWR->PDCRI,(GPIONumber&PWR_PORTI_AVAILABLE_PINS));break;#endifdefault:status=HAL_ERROR;break;}returnstatus;}HAL_StatusTypeDefHAL_PWREx_DisableGPIOPullUp(uint32_tGPIO,uint32_tGPIONumber){HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_PWR_GPIO(GPIO));assert_param(IS_PWR_GPIO_BIT_NUMBER(GPIONumber));switch(GPIO){casePWR_GPIO_A:CLEAR_BIT(PWR->PUCRA,(GPIONumber&(~(PWR_GPIO_BIT_14))));break;casePWR_GPIO_B:CLEAR_BIT(PWR->PUCRB,GPIONumber);break;casePWR_GPIO_C:CLEAR_BIT(PWR->PUCRC,GPIONumber);break;#ifdefined(GPIOD)casePWR_GPIO_D:CLEAR_BIT(PWR->PUCRD,GPIONumber);break;#endif#ifdefined(GPIOE)casePWR_GPIO_E:CLEAR_BIT(PWR->PUCRE,GPIONumber);break;#endif#ifdefined(GPIOF)casePWR_GPIO_F:CLEAR_BIT(PWR->PUCRF,GPIONumber);break;#endif#ifdefined(GPIOG)casePWR_GPIO_G:CLEAR_BIT(PWR->PUCRG,GPIONumber);break;#endifcasePWR_GPIO_H:CLEAR_BIT(PWR->PUCRH,(GPIONumber&PWR_PORTH_AVAILABLE_PINS));break;#ifdefined(GPIOI)casePWR_GPIO_I:CLEAR_BIT(PWR->PUCRI,(GPIONumber&PWR_PORTI_AVAILABLE_PINS));break;#endifdefault:status=HAL_ERROR;break;}returnstatus;}HAL_StatusTypeDefHAL_PWREx_EnableGPIOPullDown(uint32_tGPIO,uint32_tGPIONumber){HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_PWR_GPIO(GPIO));assert_param(IS_PWR_GPIO_BIT_NUMBER(GPIONumber));switch(GPIO){casePWR_GPIO_A:SET_BIT(PWR->PDCRA,(GPIONumber&(~(PWR_GPIO_BIT_13|PWR_GPIO_BIT_15))));CLEAR_BIT(PWR->PUCRA,(GPIONumber&(~(PWR_GPIO_BIT_14))));break;casePWR_GPIO_B:SET_BIT(PWR->PDCRB,(GPIONumber&(~(PWR_GPIO_BIT_4))));CLEAR_BIT(PWR->PUCRB,GPIONumber);break;casePWR_GPIO_C:SET_BIT(PWR->PDCRC,GPIONumber);CLEAR_BIT(PWR->PUCRC,GPIONumber);break;#ifdefined(GPIOD)casePWR_GPIO_D:SET_BIT(PWR->PDCRD,GPIONumber);CLEAR_BIT(PWR->PUCRD,GPIONumber);break;#endif#ifdefined(GPIOE)casePWR_GPIO_E:SET_BIT(PWR->PDCRE,GPIONumber);CLEAR_BIT(PWR->PUCRE,GPIONumber);break;#endif#ifdefined(GPIOF)casePWR_GPIO_F:SET_BIT(PWR->PDCRF,GPIONumber);CLEAR_BIT(PWR->PUCRF,GPIONumber);break;#endif#ifdefined(GPIOG)casePWR_GPIO_G:SET_BIT(PWR->PDCRG,GPIONumber);CLEAR_BIT(PWR->PUCRG,GPIONumber);break;#endifcasePWR_GPIO_H:#ifdefined(STM32L496xx)||defined(STM32L4A6xx)SET_BIT(PWR->PDCRH,((GPIONumber&PWR_PORTH_AVAILABLE_PINS)&(~(PWR_GPIO_BIT_3))));#elseSET_BIT(PWR->PDCRH,(GPIONumber&PWR_PORTH_AVAILABLE_PINS));#endifCLEAR_BIT(PWR->PUCRH,(GPIONumber&PWR_PORTH_AVAILABLE_PINS));break;#ifdefined(GPIOI)casePWR_GPIO_I:SET_BIT(PWR->PDCRI,(GPIONumber&PWR_PORTI_AVAILABLE_PINS));CLEAR_BIT(PWR->PUCRI,(GPIONumber&PWR_PORTI_AVAILABLE_PINS));break;#endifdefault:status=HAL_ERROR;break;}returnstatus;}HAL_StatusTypeDefHAL_PWREx_DisableGPIOPullDown(uint32_tGPIO,uint32_tGPIONumber){HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_PWR_GPIO(GPIO));assert_param(IS_PWR_GPIO_BIT_NUMBER(GPIONumber));switch(GPIO){casePWR_GPIO_A:CLEAR_BIT(PWR->PDCRA,(GPIONumber&(~(PWR_GPIO_BIT_13|PWR_GPIO_BIT_15))));break;casePWR_GPIO_B:CLEAR_BIT(PWR->PDCRB,(GPIONumber&(~(PWR_GPIO_BIT_4))));break;casePWR_GPIO_C:CLEAR_BIT(PWR->PDCRC,GPIONumber);break;#ifdefined(GPIOD)casePWR_GPIO_D:CLEAR_BIT(PWR->PDCRD,GPIONumber);break;#endif#ifdefined(GPIOE)casePWR_GPIO_E:CLEAR_BIT(PWR->PDCRE,GPIONumber);break;#endif#ifdefined(GPIOF)casePWR_GPIO_F:CLEAR_BIT(PWR->PDCRF,GPIONumber);break;#endif#ifdefined(GPIOG)casePWR_GPIO_G:CLEAR_BIT(PWR->PDCRG,GPIONumber);break;#endifcasePWR_GPIO_H:#ifdefined(STM32L496xx)||defined(STM32L4A6xx)CLEAR_BIT(PWR->PDCRH,((GPIONumber&PWR_PORTH_AVAILABLE_PINS)&(~(PWR_GPIO_BIT_3))));#elseCLEAR_BIT(PWR->PDCRH,(GPIONumber&PWR_PORTH_AVAILABLE_PINS));#endifbreak;#ifdefined(GPIOI)casePWR_GPIO_I:CLEAR_BIT(PWR->PDCRI,(GPIONumber&PWR_PORTI_AVAILABLE_PINS));break;#endifdefault:status=HAL_ERROR;break;}returnstatus;}voidHAL_PWREx_EnablePullUpPullDownConfig(void){SET_BIT(PWR->CR3,PWR_CR3_APC);}voidHAL_PWREx_DisablePullUpPullDownConfig(void){CLEAR_BIT(PWR->CR3,PWR_CR3_APC);}voidHAL_PWREx_EnableSRAM2ContentRetention(void){(void)HAL_PWREx_SetSRAM2ContentRetention(PWR_FULL_SRAM2_RETENTION);}voidHAL_PWREx_DisableSRAM2ContentRetention(void){(void)HAL_PWREx_SetSRAM2ContentRetention(PWR_NO_SRAM2_RETENTION);}HAL_StatusTypeDefHAL_PWREx_SetSRAM2ContentRetention(uint32_tSRAM2Size){assert_param(IS_PWR_SRAM2_RETENTION(SRAM2Size));if(SRAM2Size==PWR_NO_SRAM2_RETENTION){CLEAR_BIT(PWR->CR3,PWR_CR3_RRS);}elseif(SRAM2Size==PWR_FULL_SRAM2_RETENTION){MODIFY_REG(PWR->CR3,PWR_CR3_RRS,PWR_FULL_SRAM2_RETENTION);}#ifdefined(PWR_CR3_RRS_1)elseif(SRAM2Size==PWR_4KBYTES_SRAM2_RETENTION){MODIFY_REG(PWR->CR3,PWR_CR3_RRS,PWR_4KBYTES_SRAM2_RETENTION);}#endifelse{returnHAL_ERROR;}returnHAL_OK;}#ifdefined(PWR_CR3_ENULP)voidHAL_PWREx_EnableBORPVD_ULP(void){SET_BIT(PWR->CR3,PWR_CR3_ENULP);}voidHAL_PWREx_DisableBORPVD_ULP(void){CLEAR_BIT(PWR->CR3,PWR_CR3_ENULP);}#endif#ifdefined(PWR_CR4_EXT_SMPS_ON)voidHAL_PWREx_EnableExtSMPS_0V95(void){SET_BIT(PWR->CR4,PWR_CR4_EXT_SMPS_ON);}voidHAL_PWREx_DisableExtSMPS_0V95(void){CLEAR_BIT(PWR->CR4,PWR_CR4_EXT_SMPS_ON);}#endif#ifdefined(PWR_CR1_RRSTP)voidHAL_PWREx_EnableSRAM3ContentRetention(void){SET_BIT(PWR->CR1,PWR_CR1_RRSTP);}voidHAL_PWREx_DisableSRAM3ContentRetention(void){CLEAR_BIT(PWR->CR1,PWR_CR1_RRSTP);}#endif#ifdefined(PWR_CR3_DSIPDEN)voidHAL_PWREx_EnableDSIPinsPDActivation(void){SET_BIT(PWR->CR3,PWR_CR3_DSIPDEN);}voidHAL_PWREx_DisableDSIPinsPDActivation(void){CLEAR_BIT(PWR->CR3,PWR_CR3_DSIPDEN);}#endif#ifdefined(PWR_CR2_PVME1)voidHAL_PWREx_EnablePVM1(void){SET_BIT(PWR->CR2,PWR_PVM_1);}voidHAL_PWREx_DisablePVM1(void){CLEAR_BIT(PWR->CR2,PWR_PVM_1);}#endif#ifdefined(PWR_CR2_PVME2)voidHAL_PWREx_EnablePVM2(void){SET_BIT(PWR->CR2,PWR_PVM_2);}voidHAL_PWREx_DisablePVM2(void){CLEAR_BIT(PWR->CR2,PWR_PVM_2);}#endifvoidHAL_PWREx_EnablePVM3(void){SET_BIT(PWR->CR2,PWR_PVM_3);}voidHAL_PWREx_DisablePVM3(void){CLEAR_BIT(PWR->CR2,PWR_PVM_3);}voidHAL_PWREx_EnablePVM4(void){SET_BIT(PWR->CR2,PWR_PVM_4);}voidHAL_PWREx_DisablePVM4(void){CLEAR_BIT(PWR->CR2,PWR_PVM_4);}HAL_StatusTypeDefHAL_PWREx_ConfigPVM(PWR_PVMTypeDef*sConfigPVM){HAL_StatusTypeDefstatus=HAL_OK;assert_param(IS_PWR_PVM_TYPE(sConfigPVM->PVMType));assert_param(IS_PWR_PVM_MODE(sConfigPVM->Mode));switch(sConfigPVM->PVMType){#ifdefined(PWR_CR2_PVME1)casePWR_PVM_1:__HAL_PWR_PVM1_EXTI_DISABLE_EVENT();__HAL_PWR_PVM1_EXTI_DISABLE_IT();__HAL_PWR_PVM1_EXTI_DISABLE_FALLING_EDGE();__HAL_PWR_PVM1_EXTI_DISABLE_RISING_EDGE();if((sConfigPVM->Mode&PVM_MODE_IT)==PVM_MODE_IT){__HAL_PWR_PVM1_EXTI_ENABLE_IT();}if((sConfigPVM->Mode&PVM_MODE_EVT)==PVM_MODE_EVT){__HAL_PWR_PVM1_EXTI_ENABLE_EVENT();}if((sConfigPVM->Mode&PVM_RISING_EDGE)==PVM_RISING_EDGE){__HAL_PWR_PVM1_EXTI_ENABLE_RISING_EDGE();}if((sConfigPVM->Mode&PVM_FALLING_EDGE)==PVM_FALLING_EDGE){__HAL_PWR_PVM1_EXTI_ENABLE_FALLING_EDGE();}break;#endif#ifdefined(PWR_CR2_PVME2)casePWR_PVM_2:__HAL_PWR_PVM2_EXTI_DISABLE_EVENT();__HAL_PWR_PVM2_EXTI_DISABLE_IT();__HAL_PWR_PVM2_EXTI_DISABLE_FALLING_EDGE();__HAL_PWR_PVM2_EXTI_DISABLE_RISING_EDGE();if((sConfigPVM->Mode&PVM_MODE_IT)==PVM_MODE_IT){__HAL_PWR_PVM2_EXTI_ENABLE_IT();}if((sConfigPVM->Mode&PVM_MODE_EVT)==PVM_MODE_EVT){__HAL_PWR_PVM2_EXTI_ENABLE_EVENT();}if((sConfigPVM->Mode&PVM_RISING_EDGE)==PVM_RISING_EDGE){__HAL_PWR_PVM2_EXTI_ENABLE_RISING_EDGE();}if((sConfigPVM->Mode&PVM_FALLING_EDGE)==PVM_FALLING_EDGE){__HAL_PWR_PVM2_EXTI_ENABLE_FALLING_EDGE();}break;#endifcasePWR_PVM_3:__HAL_PWR_PVM3_EXTI_DISABLE_EVENT();__HAL_PWR_PVM3_EXTI_DISABLE_IT();__HAL_PWR_PVM3_EXTI_DISABLE_FALLING_EDGE();__HAL_PWR_PVM3_EXTI_DISABLE_RISING_EDGE();if((sConfigPVM->Mode&PVM_MODE_IT)==PVM_MODE_IT){__HAL_PWR_PVM3_EXTI_ENABLE_IT();}if((sConfigPVM->Mode&PVM_MODE_EVT)==PVM_MODE_EVT){__HAL_PWR_PVM3_EXTI_ENABLE_EVENT();}if((sConfigPVM->Mode&PVM_RISING_EDGE)==PVM_RISING_EDGE){__HAL_PWR_PVM3_EXTI_ENABLE_RISING_EDGE();}if((sConfigPVM->Mode&PVM_FALLING_EDGE)==PVM_FALLING_EDGE){__HAL_PWR_PVM3_EXTI_ENABLE_FALLING_EDGE();}break;casePWR_PVM_4:__HAL_PWR_PVM4_EXTI_DISABLE_EVENT();__HAL_PWR_PVM4_EXTI_DISABLE_IT();__HAL_PWR_PVM4_EXTI_DISABLE_FALLING_EDGE();__HAL_PWR_PVM4_EXTI_DISABLE_RISING_EDGE();if((sConfigPVM->Mode&PVM_MODE_IT)==PVM_MODE_IT){__HAL_PWR_PVM4_EXTI_ENABLE_IT();}if((sConfigPVM->Mode&PVM_MODE_EVT)==PVM_MODE_EVT){__HAL_PWR_PVM4_EXTI_ENABLE_EVENT();}if((sConfigPVM->Mode&PVM_RISING_EDGE)==PVM_RISING_EDGE){__HAL_PWR_PVM4_EXTI_ENABLE_RISING_EDGE();}if((sConfigPVM->Mode&PVM_FALLING_EDGE)==PVM_FALLING_EDGE){__HAL_PWR_PVM4_EXTI_ENABLE_FALLING_EDGE();}break;default:status=HAL_ERROR;break;}returnstatus;}voidHAL_PWREx_EnableLowPowerRunMode(void){SET_BIT(PWR->CR1,PWR_CR1_LPR);}HAL_StatusTypeDefHAL_PWREx_DisableLowPowerRunMode(void){uint32_twait_loop_index;CLEAR_BIT(PWR->CR1,PWR_CR1_LPR);wait_loop_index=((PWR_FLAG_SETTING_DELAY_US*SystemCoreClock)/1000000U)+1U;while((HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_REGLPF))&&(wait_loop_index!=0U)){wait_loop_index--;}if(HAL_IS_BIT_SET(PWR->SR2,PWR_SR2_REGLPF)){returnHAL_TIMEOUT;}returnHAL_OK;}voidHAL_PWREx_EnterSTOP0Mode(uint8_tSTOPEntry){assert_param(IS_PWR_STOP_ENTRY(STOPEntry));MODIFY_REG(PWR->CR1,PWR_CR1_LPMS,PWR_CR1_LPMS_STOP0);SET_BIT(SCB->SCR,((uint32_t)SCB_SCR_SLEEPDEEP_Msk));if(STOPEntry==PWR_STOPENTRY_WFI){__WFI();}else{__SEV();__WFE();__WFE();}CLEAR_BIT(SCB->SCR,((uint32_t)SCB_SCR_SLEEPDEEP_Msk));}voidHAL_PWREx_EnterSTOP1Mode(uint8_tSTOPEntry){assert_param(IS_PWR_STOP_ENTRY(STOPEntry));MODIFY_REG(PWR->CR1,PWR_CR1_LPMS,PWR_CR1_LPMS_STOP1);SET_BIT(SCB->SCR,((uint32_t)SCB_SCR_SLEEPDEEP_Msk));if(STOPEntry==PWR_STOPENTRY_WFI){__WFI();}else{__SEV();__WFE();__WFE();}CLEAR_BIT(SCB->SCR,((uint32_t)SCB_SCR_SLEEPDEEP_Msk));}voidHAL_PWREx_EnterSTOP2Mode(uint8_tSTOPEntry){assert_param(IS_PWR_STOP_ENTRY(STOPEntry));MODIFY_REG(PWR->CR1,PWR_CR1_LPMS,PWR_CR1_LPMS_STOP2);SET_BIT(SCB->SCR,((uint32_t)SCB_SCR_SLEEPDEEP_Msk));if(STOPEntry==PWR_STOPENTRY_WFI){__WFI();}else{__SEV();__WFE();__WFE();}CLEAR_BIT(SCB->SCR,((uint32_t)SCB_SCR_SLEEPDEEP_Msk));}voidHAL_PWREx_EnterSHUTDOWNMode(void){MODIFY_REG(PWR->CR1,PWR_CR1_LPMS,PWR_CR1_LPMS_SHUTDOWN);SET_BIT(SCB->SCR,((uint32_t)SCB_SCR_SLEEPDEEP_Msk));#ifdefined(__CC_ARM)__force_stores();#endif__WFI();}voidHAL_PWREx_PVD_PVM_IRQHandler(void){if(__HAL_PWR_PVD_EXTI_GET_FLAG()!=0x0U){HAL_PWR_PVDCallback();__HAL_PWR_PVD_EXTI_CLEAR_FLAG();}#ifdefined(PWR_CR2_PVME1)if(__HAL_PWR_PVM1_EXTI_GET_FLAG()!=0x0U){HAL_PWREx_PVM1Callback();__HAL_PWR_PVM1_EXTI_CLEAR_FLAG();}#endif#ifdefined(PWR_CR2_PVME2)if(__HAL_PWR_PVM2_EXTI_GET_FLAG()!=0x0U){HAL_PWREx_PVM2Callback();__HAL_PWR_PVM2_EXTI_CLEAR_FLAG();}#endifif(__HAL_PWR_PVM3_EXTI_GET_FLAG()!=0x0U){HAL_PWREx_PVM3Callback();__HAL_PWR_PVM3_EXTI_CLEAR_FLAG();}if(__HAL_PWR_PVM4_EXTI_GET_FLAG()!=0x0U){HAL_PWREx_PVM4Callback();__HAL_PWR_PVM4_EXTI_CLEAR_FLAG();}}#ifdefined(PWR_CR2_PVME1)__weakvoidHAL_PWREx_PVM1Callback(void){}#endif#ifdefined(PWR_CR2_PVME2)__weakvoidHAL_PWREx_PVM2Callback(void){}#endif__weakvoidHAL_PWREx_PVM3Callback(void){}__weakvoidHAL_PWREx_PVM4Callback(void){}#endif