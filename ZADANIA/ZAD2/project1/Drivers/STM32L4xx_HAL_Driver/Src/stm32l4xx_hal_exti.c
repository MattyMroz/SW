#include"stm32l4xx_hal.h"#ifdefHAL_EXTI_MODULE_ENABLED#defineEXTI_MODE_OFFSET0x08u#defineEXTI_CONFIG_OFFSET0x08uHAL_StatusTypeDefHAL_EXTI_SetConfigLine(EXTI_HandleTypeDef*hexti,EXTI_ConfigTypeDef*pExtiConfig){__IOuint32_t*regaddr;uint32_tregval;uint32_tlinepos;uint32_tmaskline;uint32_toffset;if((hexti==NULL)||(pExtiConfig==NULL)){returnHAL_ERROR;}assert_param(IS_EXTI_LINE(pExtiConfig->Line));assert_param(IS_EXTI_MODE(pExtiConfig->Mode));hexti->Line=pExtiConfig->Line;offset=((pExtiConfig->Line&EXTI_REG_MASK)>>EXTI_REG_SHIFT);linepos=(pExtiConfig->Line&EXTI_PIN_MASK);maskline=(1uL<<linepos);if((pExtiConfig->Line&EXTI_CONFIG)!=0x00u){assert_param(IS_EXTI_TRIGGER(pExtiConfig->Trigger));regaddr=(&EXTI->RTSR1+(EXTI_CONFIG_OFFSET*offset));regval=*regaddr;if((pExtiConfig->Trigger&EXTI_TRIGGER_RISING)!=0x00u){regval|=maskline;}else{regval&=~maskline;}*regaddr=regval;regaddr=(&EXTI->FTSR1+(EXTI_CONFIG_OFFSET*offset));regval=*regaddr;if((pExtiConfig->Trigger&EXTI_TRIGGER_FALLING)!=0x00u){regval|=maskline;}else{regval&=~maskline;}*regaddr=regval;if((pExtiConfig->Line&EXTI_GPIO)==EXTI_GPIO){assert_param(IS_EXTI_GPIO_PORT(pExtiConfig->GPIOSel));assert_param(IS_EXTI_GPIO_PIN(linepos));regval=SYSCFG->EXTICR[linepos>>2u];regval&=~(SYSCFG_EXTICR1_EXTI0<<(SYSCFG_EXTICR1_EXTI1_Pos*(linepos&0x03u)));regval|=(pExtiConfig->GPIOSel<<(SYSCFG_EXTICR1_EXTI1_Pos*(linepos&0x03u)));SYSCFG->EXTICR[linepos>>2u]=regval;}}regaddr=(&EXTI->IMR1+(EXTI_MODE_OFFSET*offset));regval=*regaddr;if((pExtiConfig->Mode&EXTI_MODE_INTERRUPT)!=0x00u){regval|=maskline;}else{regval&=~maskline;}*regaddr=regval;assert_param(((pExtiConfig->Line&EXTI_EVENT)==EXTI_EVENT)||((pExtiConfig->Mode&EXTI_MODE_EVENT)!=EXTI_MODE_EVENT));regaddr=(&EXTI->EMR1+(EXTI_MODE_OFFSET*offset));regval=*regaddr;if((pExtiConfig->Mode&EXTI_MODE_EVENT)!=0x00u){regval|=maskline;}else{regval&=~maskline;}*regaddr=regval;returnHAL_OK;}HAL_StatusTypeDefHAL_EXTI_GetConfigLine(EXTI_HandleTypeDef*hexti,EXTI_ConfigTypeDef*pExtiConfig){__IOuint32_t*regaddr;uint32_tregval;uint32_tlinepos;uint32_tmaskline;uint32_toffset;if((hexti==NULL)||(pExtiConfig==NULL)){returnHAL_ERROR;}assert_param(IS_EXTI_LINE(hexti->Line));pExtiConfig->Line=hexti->Line;offset=((pExtiConfig->Line&EXTI_REG_MASK)>>EXTI_REG_SHIFT);linepos=(pExtiConfig->Line&EXTI_PIN_MASK);maskline=(1uL<<linepos);regaddr=(&EXTI->IMR1+(EXTI_MODE_OFFSET*offset));regval=*regaddr;if((regval&maskline)!=0x00u){pExtiConfig->Mode=EXTI_MODE_INTERRUPT;}else{pExtiConfig->Mode=EXTI_MODE_NONE;}regaddr=(&EXTI->EMR1+(EXTI_MODE_OFFSET*offset));regval=*regaddr;if((regval&maskline)!=0x00u){pExtiConfig->Mode|=EXTI_MODE_EVENT;}pExtiConfig->Trigger=EXTI_TRIGGER_NONE;pExtiConfig->GPIOSel=0x00u;if((pExtiConfig->Line&EXTI_CONFIG)!=0x00u){regaddr=(&EXTI->RTSR1+(EXTI_CONFIG_OFFSET*offset));regval=*regaddr;if((regval&maskline)!=0x00u){pExtiConfig->Trigger=EXTI_TRIGGER_RISING;}regaddr=(&EXTI->FTSR1+(EXTI_CONFIG_OFFSET*offset));regval=*regaddr;if((regval&maskline)!=0x00u){pExtiConfig->Trigger|=EXTI_TRIGGER_FALLING;}if((pExtiConfig->Line&EXTI_GPIO)==EXTI_GPIO){assert_param(IS_EXTI_GPIO_PIN(linepos));regval=SYSCFG->EXTICR[linepos>>2u];pExtiConfig->GPIOSel=(regval>>(SYSCFG_EXTICR1_EXTI1_Pos*(linepos&0x03u)))&SYSCFG_EXTICR1_EXTI0;}}returnHAL_OK;}HAL_StatusTypeDefHAL_EXTI_ClearConfigLine(EXTI_HandleTypeDef*hexti){__IOuint32_t*regaddr;uint32_tregval;uint32_tlinepos;uint32_tmaskline;uint32_toffset;if(hexti==NULL){returnHAL_ERROR;}assert_param(IS_EXTI_LINE(hexti->Line));offset=((hexti->Line&EXTI_REG_MASK)>>EXTI_REG_SHIFT);linepos=(hexti->Line&EXTI_PIN_MASK);maskline=(1uL<<linepos);regaddr=(&EXTI->IMR1+(EXTI_MODE_OFFSET*offset));regval=(*regaddr&~maskline);*regaddr=regval;regaddr=(&EXTI->EMR1+(EXTI_MODE_OFFSET*offset));regval=(*regaddr&~maskline);*regaddr=regval;if((hexti->Line&EXTI_CONFIG)!=0x00u){regaddr=(&EXTI->RTSR1+(EXTI_CONFIG_OFFSET*offset));regval=(*regaddr&~maskline);*regaddr=regval;regaddr=(&EXTI->FTSR1+(EXTI_CONFIG_OFFSET*offset));regval=(*regaddr&~maskline);*regaddr=regval;if((hexti->Line&EXTI_GPIO)==EXTI_GPIO){assert_param(IS_EXTI_GPIO_PIN(linepos));regval=SYSCFG->EXTICR[linepos>>2u];regval&=~(SYSCFG_EXTICR1_EXTI0<<(SYSCFG_EXTICR1_EXTI1_Pos*(linepos&0x03u)));SYSCFG->EXTICR[linepos>>2u]=regval;}}returnHAL_OK;}HAL_StatusTypeDefHAL_EXTI_RegisterCallback(EXTI_HandleTypeDef*hexti,EXTI_CallbackIDTypeDefCallbackID,void(*pPendingCbfn)(void)){HAL_StatusTypeDefstatus=HAL_OK;switch(CallbackID){caseHAL_EXTI_COMMON_CB_ID:hexti->PendingCallback=pPendingCbfn;break;default:status=HAL_ERROR;break;}returnstatus;}HAL_StatusTypeDefHAL_EXTI_GetHandle(EXTI_HandleTypeDef*hexti,uint32_tExtiLine){assert_param(IS_EXTI_LINE(ExtiLine));if(hexti==NULL){returnHAL_ERROR;}else{hexti->Line=ExtiLine;returnHAL_OK;}}voidHAL_EXTI_IRQHandler(EXTI_HandleTypeDef*hexti){__IOuint32_t*regaddr;uint32_tregval;uint32_tmaskline;uint32_toffset;offset=((hexti->Line&EXTI_REG_MASK)>>EXTI_REG_SHIFT);maskline=(1uL<<(hexti->Line&EXTI_PIN_MASK));regaddr=(&EXTI->PR1+(EXTI_CONFIG_OFFSET*offset));regval=(*regaddr&maskline);if(regval!=0x00u){*regaddr=maskline;if(hexti->PendingCallback!=NULL){hexti->PendingCallback();}}}uint32_tHAL_EXTI_GetPending(EXTI_HandleTypeDef*hexti,uint32_tEdge){__IOuint32_t*regaddr;uint32_tregval;uint32_tlinepos;uint32_tmaskline;uint32_toffset;UNUSED(Edge);assert_param(IS_EXTI_LINE(hexti->Line));assert_param(IS_EXTI_CONFIG_LINE(hexti->Line));assert_param(IS_EXTI_PENDING_EDGE(Edge));offset=((hexti->Line&EXTI_REG_MASK)>>EXTI_REG_SHIFT);linepos=(hexti->Line&EXTI_PIN_MASK);maskline=(1uL<<linepos);regaddr=(&EXTI->PR1+(EXTI_CONFIG_OFFSET*offset));regval=((*regaddr&maskline)>>linepos);returnregval;}voidHAL_EXTI_ClearPending(EXTI_HandleTypeDef*hexti,uint32_tEdge){__IOuint32_t*regaddr;uint32_tmaskline;uint32_toffset;UNUSED(Edge);assert_param(IS_EXTI_LINE(hexti->Line));assert_param(IS_EXTI_CONFIG_LINE(hexti->Line));assert_param(IS_EXTI_PENDING_EDGE(Edge));offset=((hexti->Line&EXTI_REG_MASK)>>EXTI_REG_SHIFT);maskline=(1uL<<(hexti->Line&EXTI_PIN_MASK));regaddr=(&EXTI->PR1+(EXTI_CONFIG_OFFSET*offset));*regaddr=maskline;}voidHAL_EXTI_GenerateSWI(EXTI_HandleTypeDef*hexti){__IOuint32_t*regaddr;uint32_tmaskline;uint32_toffset;assert_param(IS_EXTI_LINE(hexti->Line));assert_param(IS_EXTI_CONFIG_LINE(hexti->Line));offset=((hexti->Line&EXTI_REG_MASK)>>EXTI_REG_SHIFT);maskline=(1uL<<(hexti->Line&EXTI_PIN_MASK));regaddr=(&EXTI->SWIER1+(EXTI_CONFIG_OFFSET*offset));*regaddr=maskline;}#endif