#include"stm32l4xx_hal.h"#ifdefHAL_FLASH_MODULE_ENABLED__RAM_FUNCHAL_StatusTypeDefHAL_FLASHEx_EnableRunPowerDown(void){__HAL_FLASH_POWER_DOWN_ENABLE();returnHAL_OK;}__RAM_FUNCHAL_StatusTypeDefHAL_FLASHEx_DisableRunPowerDown(void){__HAL_FLASH_POWER_DOWN_DISABLE();returnHAL_OK;}#ifdefined(STM32L4P5xx)||defined(STM32L4Q5xx)||defined(STM32L4R5xx)||defined(STM32L4R7xx)||defined(STM32L4R9xx)||defined(STM32L4S5xx)||defined(STM32L4S7xx)||defined(STM32L4S9xx)__RAM_FUNCHAL_StatusTypeDefHAL_FLASHEx_OB_DBankConfig(uint32_tDBankConfig){uint32_tcount,reg;HAL_StatusTypeDefstatus=HAL_ERROR;__HAL_LOCK(&pFlash);reg=FLASH->PCROP1SR;if(reg>FLASH->PCROP1ER){reg=FLASH->PCROP2SR;if(reg>FLASH->PCROP2ER){__HAL_FLASH_PREFETCH_BUFFER_DISABLE();if(READ_BIT(FLASH->ACR,FLASH_ACR_ICEN)!=0U){__HAL_FLASH_INSTRUCTION_CACHE_DISABLE();__HAL_FLASH_INSTRUCTION_CACHE_RESET();}if(READ_BIT(FLASH->ACR,FLASH_ACR_DCEN)!=0U){__HAL_FLASH_DATA_CACHE_DISABLE();__HAL_FLASH_DATA_CACHE_RESET();}reg=FLASH->WRP1AR;if(((reg&FLASH_WRP1AR_WRP1A_STRT)>>FLASH_WRP1AR_WRP1A_STRT_Pos)<=((reg&FLASH_WRP1AR_WRP1A_END)>>FLASH_WRP1AR_WRP1A_END_Pos)){MODIFY_REG(FLASH->WRP1AR,(FLASH_WRP1AR_WRP1A_STRT|FLASH_WRP1AR_WRP1A_END),FLASH_WRP1AR_WRP1A_STRT);}reg=FLASH->WRP1BR;if(((reg&FLASH_WRP1BR_WRP1B_STRT)>>FLASH_WRP1BR_WRP1B_STRT_Pos)<=((reg&FLASH_WRP1BR_WRP1B_END)>>FLASH_WRP1BR_WRP1B_END_Pos)){MODIFY_REG(FLASH->WRP1BR,(FLASH_WRP1BR_WRP1B_STRT|FLASH_WRP1BR_WRP1B_END),FLASH_WRP1BR_WRP1B_STRT);}reg=FLASH->WRP2AR;if(((reg&FLASH_WRP2AR_WRP2A_STRT)>>FLASH_WRP2AR_WRP2A_STRT_Pos)<=((reg&FLASH_WRP2AR_WRP2A_END)>>FLASH_WRP2AR_WRP2A_END_Pos)){MODIFY_REG(FLASH->WRP2AR,(FLASH_WRP2AR_WRP2A_STRT|FLASH_WRP2AR_WRP2A_END),FLASH_WRP2AR_WRP2A_STRT);}reg=FLASH->WRP2BR;if(((reg&FLASH_WRP2BR_WRP2B_STRT)>>FLASH_WRP2BR_WRP2B_STRT_Pos)<=((reg&FLASH_WRP2BR_WRP2B_END)>>FLASH_WRP2BR_WRP2B_END_Pos)){MODIFY_REG(FLASH->WRP2BR,(FLASH_WRP2BR_WRP2B_STRT|FLASH_WRP2BR_WRP2B_END),FLASH_WRP2BR_WRP2B_STRT);}MODIFY_REG(FLASH->OPTR,FLASH_OPTR_DBANK,DBankConfig);SET_BIT(FLASH->CR,FLASH_CR_OPTSTRT);count=FLASH_TIMEOUT_VALUE*(SystemCoreClock/8U/1000U);do{if(count==0U){break;}count--;}while(__HAL_FLASH_GET_FLAG(FLASH_FLAG_BSY)!=RESET);CLEAR_BIT(FLASH->CR,FLASH_CR_OPTSTRT);SET_BIT(FLASH->CR,FLASH_CR_OBL_LAUNCH);}}__HAL_UNLOCK(&pFlash);returnstatus;}#endif#endif