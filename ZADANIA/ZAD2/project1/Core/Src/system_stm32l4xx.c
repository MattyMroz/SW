#include"stm32l4xx.h"#if!defined(HSE_VALUE)#defineHSE_VALUE8000000U#endif#if!defined(MSI_VALUE)#defineMSI_VALUE4000000U#endif#if!defined(HSI_VALUE)#defineHSI_VALUE16000000U#endif#ifdefined(USER_VECT_TAB_ADDRESS)#ifdefined(VECT_TAB_SRAM)#defineVECT_TAB_BASE_ADDRESSSRAM1_BASE#defineVECT_TAB_OFFSET0x00000000U#else#defineVECT_TAB_BASE_ADDRESSFLASH_BASE#defineVECT_TAB_OFFSET0x00000000U#endif#endifuint32_tSystemCoreClock=4000000U;constuint8_tAHBPrescTable[16]={0U,0U,0U,0U,0U,0U,0U,0U,1U,2U,3U,4U,6U,7U,8U,9U};constuint8_tAPBPrescTable[8]={0U,0U,0U,0U,1U,2U,3U,4U};constuint32_tMSIRangeTable[12]={100000U,200000U,400000U,800000U,1000000U,2000000U,\4000000U,8000000U,16000000U,24000000U,32000000U,48000000U};voidSystemInit(void){#ifdefined(USER_VECT_TAB_ADDRESS)SCB->VTOR=VECT_TAB_BASE_ADDRESS|VECT_TAB_OFFSET;#endif#if(__FPU_PRESENT==1)&&(__FPU_USED==1)SCB->CPACR|=((3UL<<20U)|(3UL<<22U));#endif}voidSystemCoreClockUpdate(void){uint32_ttmp,msirange,pllvco,pllsource,pllm,pllr;if((RCC->CR&RCC_CR_MSIRGSEL)==0U){msirange=(RCC->CSR&RCC_CSR_MSISRANGE)>>8U;}else{msirange=(RCC->CR&RCC_CR_MSIRANGE)>>4U;}msirange=MSIRangeTable[msirange];switch(RCC->CFGR&RCC_CFGR_SWS){case0x00:SystemCoreClock=msirange;break;case0x04:SystemCoreClock=HSI_VALUE;break;case0x08:SystemCoreClock=HSE_VALUE;break;case0x0C:pllsource=(RCC->PLLCFGR&RCC_PLLCFGR_PLLSRC);pllm=((RCC->PLLCFGR&RCC_PLLCFGR_PLLM)>>4U)+1U;switch(pllsource){case0x02:pllvco=(HSI_VALUE/pllm);break;case0x03:pllvco=(HSE_VALUE/pllm);break;default:pllvco=(msirange/pllm);break;}pllvco=pllvco*((RCC->PLLCFGR&RCC_PLLCFGR_PLLN)>>8U);pllr=(((RCC->PLLCFGR&RCC_PLLCFGR_PLLR)>>25U)+1U)*2U;SystemCoreClock=pllvco/pllr;break;default:SystemCoreClock=msirange;break;}tmp=AHBPrescTable[((RCC->CFGR&RCC_CFGR_HPRE)>>4U)];SystemCoreClock>>=tmp;}